{"version":3,"sources":["SpotifyAPI.js","graphql/mutations.ts","graphql/queries.ts","Utils.ts","Auth.js","useAuth.ts","ChangeUsername.tsx","Header.js","DevPublisher.js","SpotifyWebPlayer.js","SpotifyContext.tsx","useSpotifyAPI.js","useSpotifyWebPlayer.js","SongPlayerWithControls.js","Track.js","TrackList.tsx","EQBars.js","Listeners.tsx","graphql/subscriptions.ts","WakeLockControl.tsx","Listen.js","useSpotifyContext.ts","BroadcastPollingPublisher.tsx","BroadcastWebPlayerPublisher.tsx","BroadcastPublisher.tsx","PowerHourControl.js","BroadcastHeading.tsx","Broadcast.js","Channel.js","ChannelList.tsx","graphql/customQueries.ts","Home.tsx","RedirectToLoginOrBroadcast.tsx","App.js","serviceWorker.js","aws-exports.js","index.js","logo.png"],"names":["SpotifyAPI","accessToken","onUnauthorized","Error","this","maybeHandle401","bind","response","status","fetch","method","headers","Authorization","then","ok","json","console","error","data","device","id","uri","deviceID","query","body","JSON","stringify","uris","device_ids","play","updateUser","createSongEvent","usersByDisplayName","songEventsByUserId","isUserOnline","user","latestSongEvent","Math","floor","Date","now","isUserListening","latestListenPing","getListenerCount","listeners","items","filter","listener","length","AuthContext","createContext","AuthRedirect","style","textAlign","getAuthorizeURI","pathname","redirectURI","encodeURIComponent","process","currentPath","AuthProvider","children","useLocalStorage","authInfo","setAuthInfo","location","useLocation","history","useHistory","username","userImg","displayName","expiresAt","React","useEffect","hash","params","slice","split","map","param","forEach","tup","access_token","fetchUserInfo","spotifyIdentifier","images","url","API","graphql","graphqlOperation","userID","getUser","input","type","createUser","dislayName","oldImg","mutations","push","decodeURIComponent","state","catch","handleAuthRedirect","window","self","top","e","inIframe","iframe","timeoutID","refreshAuth","document","createElement","display","src","appendChild","timeUntilExpiry","setTimeout","clearTimeout","parentNode","removeChild","authContext","useMemo","logout","retryAuth","href","Provider","value","useSpotifyAPI","useContext","ChangeUsername","initialVal","className","onSuccess","onCancel","useState","val","setVal","success","setSuccess","useAuth","onSubmit","event","preventDefault","String","trim","queries","onChange","target","onClick","Header","authorizeURI","broadcastMatch","useRouteMatch","editing","setEditing","match","to","name","includes","replace","updateName","alt","DevPublisher","hostUserID","setInterval","songEvent","timestamp","position","spotifyURI","random","toString","log","clearInterval","SpotifyWebPlayer","player","spotifyAPI","getCurrentState","pause","resume","ms","seek","nextTrack","callback","addListener","removeListener","transferPlayback","Promise","resolve","Spotify","Player","onSpotifyWebPlaybackSDKReady","sdkScript","__accessToken","__onUnauthorized","__spotifyAPI","reject","EMGlobalPlayerInstance","volumeRef","current","localStorage","getItem","toFixed","getOAuthToken","cb","volume","getVolume","newVolume","newVol","setItem","on","message","device_id","connect","inject","initializePlayer","track_window","current_track","SpotifyContext","webPlayer","webPlayerUnsupported","lastMutationTimestamp","setLastMutationTimestamp","SpotifyProvider","setWebPlayer","setWebPlayerUnsupported","setSpotifyAPI","api","createInstance","inst","spotifyContext","useSpotifyWebPlayerUnsupported","useSpotifyWebPlayer","SongPlayerWithControls","song","spotifyWebPlayer","devices","setDevices","activeDeviceID","setActiveDeviceID","activeDeviceIDRef","useRef","isReady","setIsReady","eardrumPlayer","getDeviceID","deviceList","find","d","fetchDevices","activeDevice","is_active","key","Track","track","albumImg","logo","artistName","TrackList","songs","EQBars","Listeners","hostDisplayName","hostUserImg","rerender","setRerender","r","Connect","listeningTo","sortDirection","limit","subscription","onSubscriptionMsg","prev","onUpdateUserByListeningTo","usersByListeningTo","index","findIndex","isListening","wasListening","audio","Audio","loading","onlineUsers","users","getActiveListeners","WakeLockControl","wlEnabled","setwlEnabled","NoSleep","noSleepRef","disable","handleChange","useCallback","enabled","enable","hasTouchScreen","nav","navigator","maxTouchPoints","msMaxTouchPoints","mQ","matchMedia","media","matches","UA","userAgent","test","htmlFor","checked","StartListening","publishListenPing","ListenPlayer","isCurrentlyLive","isListeningUsername","setIsListeningUsername","noSleep","intervalID","handleJoin","Listen","devPublisherEnabled","search","sub","createUserObservable","subscribe","next","newHostDisplayName","onUpdateUserByUserID","unsubscribe","onCreateSongEvent","songEventsByUserID","unshift","pop","online","useSpotifyContext","BroadcastPollingPublisher","onSongEvent","handlePlayerStateChangedRef","currentlyPlaying","newTrack","item","isPlaying","is_playing","trackID","durationMs","duration_ms","albumName","album","artists","progress_ms","timeoutIDRef","fetchCurrentlyPlaying","currentlyPlayingResponse","progressMs","timeoutDuration","BroadcastWebPlayerPublisher","newState","getTrackFromState","changeListener","initFunc","fetchState","addStateChangeListener","fetchCurrentDeviceID","removeStateChangeListener","publishBroadcastPing","BroadcastPublisher","currentSongEvent","currentSongEventRef","handleNewSongEvent","localSongEvent","__typename","publishTrack","publishSongEvent","PowerHourControl","phEnabled","setPhEnabled","phCount","setPhCount","phCallbackRef","BroadcastHeading","nameUpdated","Broadcast","songHistory","setSongHistory","copied","setCopied","handleSongEvent","h","concat","trackList","shareURI","disabled","size","text","onCopy","Channel","useParams","setHostUserID","setHostUserImg","failedLookup","setFailedLookup","fetchHostByDisplayName","host","img","cta","title","subtitle","ChannelList","usersByLatestSongEvent","sort","a","b","latestSong","songEvents","numListeners","Home","RedirectToLoginOrBroadcast","App","path","exact","Boolean","hostname","awsmobile","aws_project_region","aws_appsync_graphqlEndpoint","aws_appsync_region","aws_appsync_authenticationType","aws_appsync_apiKey","Amplify","configure","awsconfig","ReactDOM","render","StrictMode","getElementById","serviceWorker","ready","registration","unregister","module","exports"],"mappings":"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","file":"static/js/main.0e6a466c.chunk.js","sourcesContent":["export default class SpotifyAPI {\r\n  constructor(accessToken, onUnauthorized) {\r\n    if (accessToken == null) {\r\n      throw new Error(\"Access token was null\");\r\n    }\r\n    this.accessToken = accessToken;\r\n    this.onUnauthorized = onUnauthorized ?? (() => {});\r\n    this.maybeHandle401 = this.maybeHandle401.bind(this);\r\n  }\r\n\r\n  maybeHandle401(response) {\r\n    if (response.status === 401) {\r\n      this.onUnauthorized();\r\n      throw new Error(\"Unauthorized: \", response);\r\n    }\r\n    return response;\r\n  }\r\n\r\n  fetchUserInfo() {\r\n    return fetch(\"https://api.spotify.com/v1/me\", {\r\n      method: \"GET\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${this.accessToken}`,\r\n      },\r\n    })\r\n      .then(this.maybeHandle401)\r\n      .then((response) => {\r\n        if (!response.ok) {\r\n          throw response;\r\n        }\r\n        return response.json();\r\n      });\r\n  }\r\n\r\n  fetchCurrentDeviceID() {\r\n    return fetch(\"https://api.spotify.com/v1/me/player\", {\r\n      method: \"GET\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${this.accessToken}`,\r\n      },\r\n    })\r\n      .then(this.maybeHandle401)\r\n      .then((response) => {\r\n        if (!response.ok) {\r\n          console.error(\"error fetching device id\");\r\n        }\r\n        if (response.status === 204) {\r\n          return null;\r\n        }\r\n        return response.json();\r\n      })\r\n      .then((data) => {\r\n        if (data?.device?.id) {\r\n          return data.device.id;\r\n        }\r\n        return null;\r\n      });\r\n  }\r\n\r\n  play(uri, deviceID) {\r\n    const query = deviceID != null ? `?device_id=${deviceID}` : \"\";\r\n    return fetch(`https://api.spotify.com/v1/me/player/play/${query}`, {\r\n      method: \"PUT\",\r\n      body: JSON.stringify({ uris: [uri] }),\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${this.accessToken}`,\r\n      },\r\n    })\r\n      .then(this.maybeHandle401)\r\n      .then((response) => {\r\n        if (!response.ok) {\r\n          console.error(\"Error playing uri\", response);\r\n        }\r\n      });\r\n  }\r\n\r\n  transferPlayback(deviceID) {\r\n    return fetch(\"https://api.spotify.com/v1/me/player\", {\r\n      method: \"PUT\",\r\n      body: JSON.stringify({ device_ids: [deviceID], play: true }),\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${this.accessToken}`,\r\n      },\r\n    })\r\n      .then(this.maybeHandle401)\r\n      .then((response) => {\r\n        if (!response.ok) {\r\n          throw new Error(\"unable to transfer playback to device: \" + deviceID);\r\n        }\r\n      });\r\n  }\r\n\r\n  fetchDevices() {\r\n    return fetch(\"https://api.spotify.com/v1/me/player/devices\", {\r\n      method: \"GET\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${this.accessToken}`,\r\n      },\r\n    })\r\n      .then(this.maybeHandle401)\r\n      .then((response) => {\r\n        if (!response.ok) {\r\n          throw new Error(\"unable to fetch devices\");\r\n        }\r\n        return response.json();\r\n      });\r\n  }\r\n\r\n  fetchCurrentlyPlaying() {\r\n    return fetch(\"https://api.spotify.com/v1/me/player/currently-playing\", {\r\n      method: \"GET\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${this.accessToken}`,\r\n      },\r\n    })\r\n      .then(this.maybeHandle401)\r\n      .then((response) => {\r\n        if (!response.ok) {\r\n          throw new Error(\"unable to currently playing\");\r\n        }\r\n        if (response.status === 204) {\r\n          return;\r\n        }\r\n        return response.json();\r\n      });\r\n  }\r\n\r\n  nextTrack() {\r\n    return fetch(\"https://api.spotify.com/v1/me/player/next\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${this.accessToken}`,\r\n      },\r\n    })\r\n      .then(this.maybeHandle401)\r\n      .then((response) => {\r\n        if (!response.ok) {\r\n          throw new Error(\"unable to select next track\");\r\n        }\r\n        if (response.status === 204) {\r\n          return;\r\n        }\r\n        return response.json();\r\n      });\r\n  }\r\n}\r\n","// tslint:disable\r\n// eslint-disable\r\n// this is an auto generated file. This will be overwritten\r\n\r\nexport const createUser = /* GraphQL */ `\r\n  mutation CreateUser(\r\n    $input: CreateUserInput!\r\n    $condition: ModelUserConditionInput\r\n  ) {\r\n    createUser(input: $input, condition: $condition) {\r\n      userID\r\n      latestSongEvent\r\n      latestListenPing\r\n      listeningTo\r\n      songEvents {\r\n        items {\r\n          id\r\n          spotifyURI\r\n          timestamp\r\n          position\r\n          track {\r\n            uri\r\n            trackID\r\n            name\r\n            durationMs\r\n            albumName\r\n            artistName\r\n            albumImg\r\n          }\r\n          userID\r\n          user {\r\n            userID\r\n            latestSongEvent\r\n            latestListenPing\r\n            listeningTo\r\n            displayName\r\n            userImg\r\n            type\r\n          }\r\n          type\r\n        }\r\n        nextToken\r\n      }\r\n      listeners {\r\n        items {\r\n          userID\r\n          latestSongEvent\r\n          latestListenPing\r\n          listeningTo\r\n          songEvents {\r\n            nextToken\r\n          }\r\n          listeners {\r\n            nextToken\r\n          }\r\n          displayName\r\n          userImg\r\n          type\r\n        }\r\n        nextToken\r\n      }\r\n      displayName\r\n      userImg\r\n      type\r\n    }\r\n  }\r\n`;\r\nexport const updateUser = /* GraphQL */ `\r\n  mutation UpdateUser(\r\n    $input: UpdateUserInput!\r\n    $condition: ModelUserConditionInput\r\n  ) {\r\n    updateUser(input: $input, condition: $condition) {\r\n      userID\r\n      latestSongEvent\r\n      latestListenPing\r\n      listeningTo\r\n      songEvents {\r\n        items {\r\n          id\r\n          spotifyURI\r\n          timestamp\r\n          position\r\n          track {\r\n            uri\r\n            trackID\r\n            name\r\n            durationMs\r\n            albumName\r\n            artistName\r\n            albumImg\r\n          }\r\n          userID\r\n          user {\r\n            userID\r\n            latestSongEvent\r\n            latestListenPing\r\n            listeningTo\r\n            displayName\r\n            userImg\r\n            type\r\n          }\r\n          type\r\n        }\r\n        nextToken\r\n      }\r\n      listeners {\r\n        items {\r\n          userID\r\n          latestSongEvent\r\n          latestListenPing\r\n          listeningTo\r\n          songEvents {\r\n            nextToken\r\n          }\r\n          listeners {\r\n            nextToken\r\n          }\r\n          displayName\r\n          userImg\r\n          type\r\n        }\r\n        nextToken\r\n      }\r\n      displayName\r\n      userImg\r\n      type\r\n    }\r\n  }\r\n`;\r\nexport const deleteUser = /* GraphQL */ `\r\n  mutation DeleteUser(\r\n    $input: DeleteUserInput!\r\n    $condition: ModelUserConditionInput\r\n  ) {\r\n    deleteUser(input: $input, condition: $condition) {\r\n      userID\r\n      latestSongEvent\r\n      latestListenPing\r\n      listeningTo\r\n      songEvents {\r\n        items {\r\n          id\r\n          spotifyURI\r\n          timestamp\r\n          position\r\n          track {\r\n            uri\r\n            trackID\r\n            name\r\n            durationMs\r\n            albumName\r\n            artistName\r\n            albumImg\r\n          }\r\n          userID\r\n          user {\r\n            userID\r\n            latestSongEvent\r\n            latestListenPing\r\n            listeningTo\r\n            displayName\r\n            userImg\r\n            type\r\n          }\r\n          type\r\n        }\r\n        nextToken\r\n      }\r\n      listeners {\r\n        items {\r\n          userID\r\n          latestSongEvent\r\n          latestListenPing\r\n          listeningTo\r\n          songEvents {\r\n            nextToken\r\n          }\r\n          listeners {\r\n            nextToken\r\n          }\r\n          displayName\r\n          userImg\r\n          type\r\n        }\r\n        nextToken\r\n      }\r\n      displayName\r\n      userImg\r\n      type\r\n    }\r\n  }\r\n`;\r\nexport const createSongEvent = /* GraphQL */ `\r\n  mutation CreateSongEvent(\r\n    $input: CreateSongEventInput!\r\n    $condition: ModelSongEventConditionInput\r\n  ) {\r\n    createSongEvent(input: $input, condition: $condition) {\r\n      id\r\n      spotifyURI\r\n      timestamp\r\n      position\r\n      track {\r\n        uri\r\n        trackID\r\n        name\r\n        durationMs\r\n        albumName\r\n        artistName\r\n        albumImg\r\n      }\r\n      userID\r\n      user {\r\n        userID\r\n        latestSongEvent\r\n        latestListenPing\r\n        listeningTo\r\n        songEvents {\r\n          items {\r\n            id\r\n            spotifyURI\r\n            timestamp\r\n            position\r\n            userID\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        listeners {\r\n          items {\r\n            userID\r\n            latestSongEvent\r\n            latestListenPing\r\n            listeningTo\r\n            displayName\r\n            userImg\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        displayName\r\n        userImg\r\n        type\r\n      }\r\n      type\r\n    }\r\n  }\r\n`;\r\nexport const updateSongEvent = /* GraphQL */ `\r\n  mutation UpdateSongEvent(\r\n    $input: UpdateSongEventInput!\r\n    $condition: ModelSongEventConditionInput\r\n  ) {\r\n    updateSongEvent(input: $input, condition: $condition) {\r\n      id\r\n      spotifyURI\r\n      timestamp\r\n      position\r\n      track {\r\n        uri\r\n        trackID\r\n        name\r\n        durationMs\r\n        albumName\r\n        artistName\r\n        albumImg\r\n      }\r\n      userID\r\n      user {\r\n        userID\r\n        latestSongEvent\r\n        latestListenPing\r\n        listeningTo\r\n        songEvents {\r\n          items {\r\n            id\r\n            spotifyURI\r\n            timestamp\r\n            position\r\n            userID\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        listeners {\r\n          items {\r\n            userID\r\n            latestSongEvent\r\n            latestListenPing\r\n            listeningTo\r\n            displayName\r\n            userImg\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        displayName\r\n        userImg\r\n        type\r\n      }\r\n      type\r\n    }\r\n  }\r\n`;\r\nexport const deleteSongEvent = /* GraphQL */ `\r\n  mutation DeleteSongEvent(\r\n    $input: DeleteSongEventInput!\r\n    $condition: ModelSongEventConditionInput\r\n  ) {\r\n    deleteSongEvent(input: $input, condition: $condition) {\r\n      id\r\n      spotifyURI\r\n      timestamp\r\n      position\r\n      track {\r\n        uri\r\n        trackID\r\n        name\r\n        durationMs\r\n        albumName\r\n        artistName\r\n        albumImg\r\n      }\r\n      userID\r\n      user {\r\n        userID\r\n        latestSongEvent\r\n        latestListenPing\r\n        listeningTo\r\n        songEvents {\r\n          items {\r\n            id\r\n            spotifyURI\r\n            timestamp\r\n            position\r\n            userID\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        listeners {\r\n          items {\r\n            userID\r\n            latestSongEvent\r\n            latestListenPing\r\n            listeningTo\r\n            displayName\r\n            userImg\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        displayName\r\n        userImg\r\n        type\r\n      }\r\n      type\r\n    }\r\n  }\r\n`;\r\nexport const createTrack = /* GraphQL */ `\r\n  mutation CreateTrack(\r\n    $input: CreateTrackInput!\r\n    $condition: ModelTrackConditionInput\r\n  ) {\r\n    createTrack(input: $input, condition: $condition) {\r\n      uri\r\n      trackID\r\n      name\r\n      durationMs\r\n      albumName\r\n      artistName\r\n      albumImg\r\n    }\r\n  }\r\n`;\r\nexport const updateTrack = /* GraphQL */ `\r\n  mutation UpdateTrack(\r\n    $input: UpdateTrackInput!\r\n    $condition: ModelTrackConditionInput\r\n  ) {\r\n    updateTrack(input: $input, condition: $condition) {\r\n      uri\r\n      trackID\r\n      name\r\n      durationMs\r\n      albumName\r\n      artistName\r\n      albumImg\r\n    }\r\n  }\r\n`;\r\nexport const deleteTrack = /* GraphQL */ `\r\n  mutation DeleteTrack(\r\n    $input: DeleteTrackInput!\r\n    $condition: ModelTrackConditionInput\r\n  ) {\r\n    deleteTrack(input: $input, condition: $condition) {\r\n      uri\r\n      trackID\r\n      name\r\n      durationMs\r\n      albumName\r\n      artistName\r\n      albumImg\r\n    }\r\n  }\r\n`;\r\n","// tslint:disable\r\n// eslint-disable\r\n// this is an auto generated file. This will be overwritten\r\n\r\nexport const getUser = /* GraphQL */ `\r\n  query GetUser($userID: String!) {\r\n    getUser(userID: $userID) {\r\n      userID\r\n      latestSongEvent\r\n      latestListenPing\r\n      listeningTo\r\n      songEvents {\r\n        items {\r\n          id\r\n          spotifyURI\r\n          timestamp\r\n          position\r\n          track {\r\n            uri\r\n            trackID\r\n            name\r\n            durationMs\r\n            albumName\r\n            artistName\r\n            albumImg\r\n          }\r\n          userID\r\n          user {\r\n            userID\r\n            latestSongEvent\r\n            latestListenPing\r\n            listeningTo\r\n            displayName\r\n            userImg\r\n            type\r\n          }\r\n          type\r\n        }\r\n        nextToken\r\n      }\r\n      listeners {\r\n        items {\r\n          userID\r\n          latestSongEvent\r\n          latestListenPing\r\n          listeningTo\r\n          songEvents {\r\n            nextToken\r\n          }\r\n          listeners {\r\n            nextToken\r\n          }\r\n          displayName\r\n          userImg\r\n          type\r\n        }\r\n        nextToken\r\n      }\r\n      displayName\r\n      userImg\r\n      type\r\n    }\r\n  }\r\n`;\r\nexport const listUsers = /* GraphQL */ `\r\n  query ListUsers(\r\n    $userID: String\r\n    $filter: ModelUserFilterInput\r\n    $limit: Int\r\n    $nextToken: String\r\n    $sortDirection: ModelSortDirection\r\n  ) {\r\n    listUsers(\r\n      userID: $userID\r\n      filter: $filter\r\n      limit: $limit\r\n      nextToken: $nextToken\r\n      sortDirection: $sortDirection\r\n    ) {\r\n      items {\r\n        userID\r\n        latestSongEvent\r\n        latestListenPing\r\n        listeningTo\r\n        songEvents {\r\n          items {\r\n            id\r\n            spotifyURI\r\n            timestamp\r\n            position\r\n            userID\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        listeners {\r\n          items {\r\n            userID\r\n            latestSongEvent\r\n            latestListenPing\r\n            listeningTo\r\n            displayName\r\n            userImg\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        displayName\r\n        userImg\r\n        type\r\n      }\r\n      nextToken\r\n    }\r\n  }\r\n`;\r\nexport const getSongEvent = /* GraphQL */ `\r\n  query GetSongEvent($id: ID!) {\r\n    getSongEvent(id: $id) {\r\n      id\r\n      spotifyURI\r\n      timestamp\r\n      position\r\n      track {\r\n        uri\r\n        trackID\r\n        name\r\n        durationMs\r\n        albumName\r\n        artistName\r\n        albumImg\r\n      }\r\n      userID\r\n      user {\r\n        userID\r\n        latestSongEvent\r\n        latestListenPing\r\n        listeningTo\r\n        songEvents {\r\n          items {\r\n            id\r\n            spotifyURI\r\n            timestamp\r\n            position\r\n            userID\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        listeners {\r\n          items {\r\n            userID\r\n            latestSongEvent\r\n            latestListenPing\r\n            listeningTo\r\n            displayName\r\n            userImg\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        displayName\r\n        userImg\r\n        type\r\n      }\r\n      type\r\n    }\r\n  }\r\n`;\r\nexport const listSongEvents = /* GraphQL */ `\r\n  query ListSongEvents(\r\n    $filter: ModelSongEventFilterInput\r\n    $limit: Int\r\n    $nextToken: String\r\n  ) {\r\n    listSongEvents(filter: $filter, limit: $limit, nextToken: $nextToken) {\r\n      items {\r\n        id\r\n        spotifyURI\r\n        timestamp\r\n        position\r\n        track {\r\n          uri\r\n          trackID\r\n          name\r\n          durationMs\r\n          albumName\r\n          artistName\r\n          albumImg\r\n        }\r\n        userID\r\n        user {\r\n          userID\r\n          latestSongEvent\r\n          latestListenPing\r\n          listeningTo\r\n          songEvents {\r\n            nextToken\r\n          }\r\n          listeners {\r\n            nextToken\r\n          }\r\n          displayName\r\n          userImg\r\n          type\r\n        }\r\n        type\r\n      }\r\n      nextToken\r\n    }\r\n  }\r\n`;\r\nexport const getTrack = /* GraphQL */ `\r\n  query GetTrack($uri: String!) {\r\n    getTrack(uri: $uri) {\r\n      uri\r\n      trackID\r\n      name\r\n      durationMs\r\n      albumName\r\n      artistName\r\n      albumImg\r\n    }\r\n  }\r\n`;\r\nexport const listTracks = /* GraphQL */ `\r\n  query ListTracks(\r\n    $uri: String\r\n    $filter: ModelTrackFilterInput\r\n    $limit: Int\r\n    $nextToken: String\r\n    $sortDirection: ModelSortDirection\r\n  ) {\r\n    listTracks(\r\n      uri: $uri\r\n      filter: $filter\r\n      limit: $limit\r\n      nextToken: $nextToken\r\n      sortDirection: $sortDirection\r\n    ) {\r\n      items {\r\n        uri\r\n        trackID\r\n        name\r\n        durationMs\r\n        albumName\r\n        artistName\r\n        albumImg\r\n      }\r\n      nextToken\r\n    }\r\n  }\r\n`;\r\nexport const usersByLatestSongEvent = /* GraphQL */ `\r\n  query UsersByLatestSongEvent(\r\n    $type: String\r\n    $latestSongEvent: ModelIntKeyConditionInput\r\n    $sortDirection: ModelSortDirection\r\n    $filter: ModelUserFilterInput\r\n    $limit: Int\r\n    $nextToken: String\r\n  ) {\r\n    usersByLatestSongEvent(\r\n      type: $type\r\n      latestSongEvent: $latestSongEvent\r\n      sortDirection: $sortDirection\r\n      filter: $filter\r\n      limit: $limit\r\n      nextToken: $nextToken\r\n    ) {\r\n      items {\r\n        userID\r\n        latestSongEvent\r\n        latestListenPing\r\n        listeningTo\r\n        songEvents {\r\n          items {\r\n            id\r\n            spotifyURI\r\n            timestamp\r\n            position\r\n            userID\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        listeners {\r\n          items {\r\n            userID\r\n            latestSongEvent\r\n            latestListenPing\r\n            listeningTo\r\n            displayName\r\n            userImg\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        displayName\r\n        userImg\r\n        type\r\n      }\r\n      nextToken\r\n    }\r\n  }\r\n`;\r\nexport const usersByListeningTo = /* GraphQL */ `\r\n  query UsersByListeningTo(\r\n    $listeningTo: String\r\n    $latestListenPing: ModelIntKeyConditionInput\r\n    $sortDirection: ModelSortDirection\r\n    $filter: ModelUserFilterInput\r\n    $limit: Int\r\n    $nextToken: String\r\n  ) {\r\n    usersByListeningTo(\r\n      listeningTo: $listeningTo\r\n      latestListenPing: $latestListenPing\r\n      sortDirection: $sortDirection\r\n      filter: $filter\r\n      limit: $limit\r\n      nextToken: $nextToken\r\n    ) {\r\n      items {\r\n        userID\r\n        latestSongEvent\r\n        latestListenPing\r\n        listeningTo\r\n        songEvents {\r\n          items {\r\n            id\r\n            spotifyURI\r\n            timestamp\r\n            position\r\n            userID\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        listeners {\r\n          items {\r\n            userID\r\n            latestSongEvent\r\n            latestListenPing\r\n            listeningTo\r\n            displayName\r\n            userImg\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        displayName\r\n        userImg\r\n        type\r\n      }\r\n      nextToken\r\n    }\r\n  }\r\n`;\r\nexport const usersByDisplayName = /* GraphQL */ `\r\n  query UsersByDisplayName(\r\n    $displayName: String\r\n    $latestSongEvent: ModelIntKeyConditionInput\r\n    $sortDirection: ModelSortDirection\r\n    $filter: ModelUserFilterInput\r\n    $limit: Int\r\n    $nextToken: String\r\n  ) {\r\n    usersByDisplayName(\r\n      displayName: $displayName\r\n      latestSongEvent: $latestSongEvent\r\n      sortDirection: $sortDirection\r\n      filter: $filter\r\n      limit: $limit\r\n      nextToken: $nextToken\r\n    ) {\r\n      items {\r\n        userID\r\n        latestSongEvent\r\n        latestListenPing\r\n        listeningTo\r\n        songEvents {\r\n          items {\r\n            id\r\n            spotifyURI\r\n            timestamp\r\n            position\r\n            userID\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        listeners {\r\n          items {\r\n            userID\r\n            latestSongEvent\r\n            latestListenPing\r\n            listeningTo\r\n            displayName\r\n            userImg\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        displayName\r\n        userImg\r\n        type\r\n      }\r\n      nextToken\r\n    }\r\n  }\r\n`;\r\nexport const songEventsByUserId = /* GraphQL */ `\r\n  query SongEventsByUserId(\r\n    $userID: String\r\n    $timestamp: ModelIntKeyConditionInput\r\n    $sortDirection: ModelSortDirection\r\n    $filter: ModelSongEventFilterInput\r\n    $limit: Int\r\n    $nextToken: String\r\n  ) {\r\n    songEventsByUserID(\r\n      userID: $userID\r\n      timestamp: $timestamp\r\n      sortDirection: $sortDirection\r\n      filter: $filter\r\n      limit: $limit\r\n      nextToken: $nextToken\r\n    ) {\r\n      items {\r\n        id\r\n        spotifyURI\r\n        timestamp\r\n        position\r\n        track {\r\n          uri\r\n          trackID\r\n          name\r\n          durationMs\r\n          albumName\r\n          artistName\r\n          albumImg\r\n        }\r\n        userID\r\n        user {\r\n          userID\r\n          latestSongEvent\r\n          latestListenPing\r\n          listeningTo\r\n          songEvents {\r\n            nextToken\r\n          }\r\n          listeners {\r\n            nextToken\r\n          }\r\n          displayName\r\n          userImg\r\n          type\r\n        }\r\n        type\r\n      }\r\n      nextToken\r\n    }\r\n  }\r\n`;\r\nexport const songEventsByType = /* GraphQL */ `\r\n  query SongEventsByType(\r\n    $type: String\r\n    $timestamp: ModelIntKeyConditionInput\r\n    $sortDirection: ModelSortDirection\r\n    $filter: ModelSongEventFilterInput\r\n    $limit: Int\r\n    $nextToken: String\r\n  ) {\r\n    songEventsByType(\r\n      type: $type\r\n      timestamp: $timestamp\r\n      sortDirection: $sortDirection\r\n      filter: $filter\r\n      limit: $limit\r\n      nextToken: $nextToken\r\n    ) {\r\n      items {\r\n        id\r\n        spotifyURI\r\n        timestamp\r\n        position\r\n        track {\r\n          uri\r\n          trackID\r\n          name\r\n          durationMs\r\n          albumName\r\n          artistName\r\n          albumImg\r\n        }\r\n        userID\r\n        user {\r\n          userID\r\n          latestSongEvent\r\n          latestListenPing\r\n          listeningTo\r\n          songEvents {\r\n            nextToken\r\n          }\r\n          listeners {\r\n            nextToken\r\n          }\r\n          displayName\r\n          userImg\r\n          type\r\n        }\r\n        type\r\n      }\r\n      nextToken\r\n    }\r\n  }\r\n`;\r\n","import type { User, SongEvent } from \"./Types\";\r\n\r\nexport function getActiveListeners(users: User[]): User[] {\r\n  return users.filter((user) => {\r\n    if (user == null) {\r\n      return false;\r\n    }\r\n    const isOnline =\r\n      Math.floor(Date.now() / 1000) - (user?.latestListenPing ?? 0) < 30;\r\n    return isOnline;\r\n  }) as User[];\r\n}\r\n\r\nexport function isUserOnline(user: User): boolean {\r\n  if (user == null) {\r\n    return false;\r\n  }\r\n  const latestSongEvent = user.latestSongEvent ?? 0;\r\n  return Math.floor(Date.now() / 1000) - latestSongEvent < 30;\r\n}\r\n\r\nexport function isUserListening(user: User): boolean {\r\n  if (user == null) {\r\n    return false;\r\n  }\r\n  const hasRecentPing =\r\n    Math.floor(Date.now() / 1000) - (user.latestListenPing ?? 0) < 30;\r\n  return hasRecentPing;\r\n}\r\n\r\nexport function isOnline(songEvents: SongEvent[]): boolean {\r\n  const mostRecentSongEvent = songEvents && songEvents[0];\r\n  if (mostRecentSongEvent == null) {\r\n    return false;\r\n  }\r\n  const isOnline =\r\n    Math.floor(Date.now() / 1000) - mostRecentSongEvent.timestamp <\r\n    (mostRecentSongEvent.track?.durationMs ?? 0) / 1000 + 60;\r\n  return isOnline;\r\n}\r\n\r\nexport function getListenerCount(user: User) {\r\n  return (\r\n    (user?.listeners?.items ?? []).filter((listener) => {\r\n      if (listener == null) {\r\n        return false;\r\n      }\r\n      return isUserListening(listener as User);\r\n    }).length + 1\r\n  );\r\n}\r\n\r\nexport function inIframe() {\r\n  try {\r\n    return window.self !== window.top;\r\n  } catch (e) {\r\n    return true;\r\n  }\r\n}\r\n\r\nexport function hasTouchScreen() {\r\n  let hasTouchScreen = false;\r\n  const nav = window.navigator as any;\r\n  if (\"maxTouchPoints\" in nav) {\r\n    hasTouchScreen = nav.maxTouchPoints > 0;\r\n  } else if (\"msMaxTouchPoints\" in nav) {\r\n    hasTouchScreen = nav.msMaxTouchPoints > 0;\r\n  } else {\r\n    var mQ = window.matchMedia && matchMedia(\"(pointer:coarse)\");\r\n    if (mQ && mQ.media === \"(pointer:coarse)\") {\r\n      hasTouchScreen = !!mQ.matches;\r\n    } else if (\"orientation\" in window) {\r\n      hasTouchScreen = true; // deprecated, but good fallback\r\n    } else {\r\n      // Only as a last resort, fall back to user agent sniffing\r\n      var UA = nav.userAgent;\r\n      hasTouchScreen =\r\n        /\\b(BlackBerry|webOS|iPhone|IEMobile)\\b/i.test(UA) ||\r\n        /\\b(Android|Windows Phone|iPad|iPod)\\b/i.test(UA);\r\n    }\r\n  }\r\n  return hasTouchScreen;\r\n}\r\n","import React, { createContext } from \"react\";\r\nimport { useLocalStorage } from \"@rehooks/local-storage\";\r\nimport SpotifyAPI from \"./SpotifyAPI.js\";\r\nimport { useHistory, useLocation } from \"react-router-dom\";\r\nimport { API, graphqlOperation } from \"aws-amplify\";\r\nimport * as mutations from \"./graphql/mutations\";\r\nimport * as queries from \"./graphql/queries\";\r\nimport { inIframe } from \"./Utils\";\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport function AuthRedirect() {\r\n  return <div style={{ textAlign: \"center\" }}>Logging in...</div>;\r\n}\r\n\r\nexport function getAuthorizeURI(pathname) {\r\n  const clientID = process.env.REACT_APP_SPOTIFY_CLIENT_ID;\r\n  const scopes = process.env.REACT_APP_SPOTIFY_SCOPES;\r\n  const redirectURI = encodeURIComponent(\r\n    process.env.REACT_APP_SPOTIFY_REDIRECT_URI\r\n  );\r\n  const currentPath = encodeURIComponent(pathname);\r\n  return `https://accounts.spotify.com/authorize?response_type=token&client_id=${clientID}&scope=${scopes}&redirect_uri=${redirectURI}&state=${currentPath}`;\r\n}\r\n\r\nfunction handleAuthRedirect(setAuthInfo, history, location) {\r\n  if (location.hash) {\r\n    const params = {};\r\n    location.hash\r\n      .slice(1)\r\n      .split(\"&\")\r\n      .map((param) => param.split(\"=\"))\r\n      .forEach((tup) => {\r\n        params[tup[0]] = tup[1];\r\n      });\r\n    const accessToken = params.access_token;\r\n    if (accessToken == null) {\r\n      return;\r\n    }\r\n    location.hash = \"\";\r\n    new SpotifyAPI(accessToken).fetchUserInfo().then((user) => {\r\n      const spotifyIdentifier = user.id;\r\n      const userImg = user.images?.[0]?.url ?? null;\r\n      // Ensure the user is created upon login\r\n      API.graphql(\r\n        graphqlOperation(queries.getUser, {\r\n          userID: spotifyIdentifier,\r\n        })\r\n      )\r\n        .then((data) => {\r\n          if (data.data.getUser == null) {\r\n            return API.graphql(\r\n              graphqlOperation(mutations.createUser, {\r\n                input: {\r\n                  userID: spotifyIdentifier,\r\n                  displayName: spotifyIdentifier,\r\n                  userImg: userImg,\r\n                  type: \"USER\",\r\n                },\r\n              })\r\n            ).then((data) => {\r\n              return data.data.createUser.dislayName;\r\n            });\r\n          } else {\r\n            const oldImg = data?.data?.getUser?.userImg;\r\n            if (userImg != null && userImg !== oldImg) {\r\n              API.graphql(\r\n                graphqlOperation(mutations.updateUser, {\r\n                  input: {\r\n                    userID: spotifyIdentifier,\r\n                    userImg: userImg,\r\n                  },\r\n                })\r\n              );\r\n            }\r\n          }\r\n          return data.data.getUser.displayName;\r\n        })\r\n        .then((displayName) => {\r\n          setAuthInfo({\r\n            accessToken,\r\n            username: spotifyIdentifier,\r\n            displayName,\r\n            userImg,\r\n            expiresAt: Math.floor(Date.now() / 1000) + (3600 - 30),\r\n          });\r\n          history.push(decodeURIComponent(params.state));\r\n        })\r\n        .catch(() => {\r\n          history.push(\"/\");\r\n          console.error(\"user creation failed\");\r\n        });\r\n    });\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [authInfo, setAuthInfo] = useLocalStorage(\"EMAuthInfo\");\r\n  const location = useLocation();\r\n  const history = useHistory();\r\n  const username = authInfo?.username;\r\n  const accessToken = authInfo?.accessToken;\r\n  const userImg = authInfo?.userImg;\r\n  const displayName = authInfo?.displayName || username;\r\n  const expiresAt = authInfo?.expiresAt;\r\n\r\n  React.useEffect(() => {\r\n    handleAuthRedirect(setAuthInfo, history, location);\r\n  }, [setAuthInfo, history, location]);\r\n\r\n  React.useEffect(() => {\r\n    if (expiresAt == null || inIframe()) {\r\n      return;\r\n    }\r\n\r\n    let iframe = null;\r\n    let timeoutID = null;\r\n    const refreshAuth = () => {\r\n      iframe = document.createElement(\"iframe\");\r\n      iframe.style.display = \"none\";\r\n      iframe.src = getAuthorizeURI(\"/auth\");\r\n      document.body.appendChild(iframe);\r\n    };\r\n    const timeUntilExpiry = (expiresAt ?? 0) - Math.floor(Date.now() / 1000);\r\n    if (timeUntilExpiry > 0) {\r\n      timeoutID = setTimeout(() => {\r\n        refreshAuth();\r\n      }, timeUntilExpiry * 1000);\r\n    } else {\r\n      refreshAuth();\r\n    }\r\n    return () => {\r\n      if (timeoutID != null) {\r\n        clearTimeout(timeoutID);\r\n      }\r\n      if (iframe != null) {\r\n        iframe.parentNode.removeChild(iframe);\r\n      }\r\n    };\r\n  }, [expiresAt, location]);\r\n\r\n  const authContext = React.useMemo(() => {\r\n    return accessToken != null && username != null\r\n      ? {\r\n          accessToken: accessToken,\r\n          username: username,\r\n          userImg: userImg,\r\n          displayName: displayName,\r\n          logout: () => setAuthInfo(null),\r\n          retryAuth: () => {\r\n            setAuthInfo(null);\r\n            window.location.href = getAuthorizeURI(window.location.pathname);\r\n          },\r\n          setAuthInfo: setAuthInfo,\r\n        }\r\n      : null;\r\n  }, [username, accessToken, setAuthInfo, userImg, displayName]);\r\n\r\n  return (\r\n    <AuthContext.Provider value={authContext}>{children}</AuthContext.Provider>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport { AuthContext } from \"./Auth\";\r\n\r\nexport type AuthInfo = {\r\n  username: string;\r\n  accessToken: string;\r\n  userImg: string | null;\r\n  displayName: string | null;\r\n  retryAuth: () => void;\r\n  setAuthInfo: (authInfo: AuthInfo) => void;\r\n} | null;\r\n\r\nexport default function useSpotifyAPI(): AuthInfo {\r\n  const authContext = React.useContext(AuthContext);\r\n  return authContext as AuthInfo;\r\n}\r\n","import React from \"react\";\nimport useAuth from \"./useAuth\";\nimport { GraphQLResult } from \"@aws-amplify/api-graphql\";\nimport { API, graphqlOperation } from \"aws-amplify\";\nimport * as mutations from \"./graphql/mutations\";\nimport * as queries from \"./graphql/queries\";\nimport \"./ChangeUsername.css\";\n\nfunction updateDisplayName(userID: string, displayName: string) {\n  return (API.graphql(\n    graphqlOperation(queries.usersByDisplayName, {\n      displayName,\n    })\n  ) as Promise<GraphQLResult>)\n    .then((data: any) => {\n      const user = data?.data?.usersByDisplayName?.items?.[0];\n      if (user != null) {\n        throw new Error(\"Username exists\");\n      }\n    })\n    .then(() => {\n      return API.graphql(\n        graphqlOperation(mutations.updateUser, {\n          input: {\n            userID,\n            displayName,\n          },\n        })\n      ) as Promise<GraphQLResult>;\n    }) as Promise<GraphQLResult>;\n}\n\nexport default function ChangeUsername({\n  initialVal,\n  className,\n  onSuccess,\n  onCancel,\n}: {\n  initialVal: string;\n  className?: string;\n  onSuccess: (name: string) => void;\n  onCancel: () => void;\n}) {\n  const [val, setVal] = React.useState<string>(initialVal);\n  const [success, setSuccess] = React.useState<boolean | null>(null);\n  const authInfo = useAuth();\n\n  const handleUpdate = (e: any) => {\n    setVal(e.target.value);\n  };\n\n  const updateName = (event: any) => {\n    if (authInfo == null) {\n      return;\n    }\n    event.preventDefault();\n    const value = String(val).trim();\n    updateDisplayName(authInfo.username, value)\n      .then(() => {\n        setSuccess(true);\n        onSuccess(value);\n        authInfo.setAuthInfo({ ...authInfo, displayName: value });\n      })\n      .catch(() => {\n        setSuccess(false);\n      });\n  };\n\n  return (\n    <div className={className}>\n      <form onSubmit={updateName}>\n        <label className=\"ChangeUsername-label\">New name: </label>\n        <input value={val} onChange={handleUpdate} />\n        <div>\n          <input type=\"submit\" value=\"Submit\" />\n          <button type=\"button\" onClick={() => onCancel()}>\n            Cancel\n          </button>\n        </div>\n      </form>\n      {success === null ? null : success === false ? \"Error\" : \"Success!\"}\n    </div>\n  );\n}\n","import React from \"react\";\r\nimport { Link, useRouteMatch, useHistory } from \"react-router-dom\";\r\nimport { AuthContext, getAuthorizeURI } from \"./Auth.js\";\r\nimport ChangeUsername from \"./ChangeUsername\";\r\n\r\nfunction Header() {\r\n  const authInfo = React.useContext(AuthContext);\r\n  const authorizeURI = getAuthorizeURI(\"/broadcast\");\r\n  const broadcastMatch = useRouteMatch(\"/u/\" + authInfo?.displayName);\r\n  const [editing, setEditing] = React.useState(false);\r\n  const match = useRouteMatch(\"/u/:id\");\r\n  const history = useHistory();\r\n\r\n  function handleLogout(e) {\r\n    e.preventDefault();\r\n    authInfo.logout();\r\n  }\r\n  const updateName = (name) => {\r\n    setEditing(false);\r\n    if (\r\n      match?.params &&\r\n      authInfo.displayName &&\r\n      decodeURIComponent(match.params.id).includes(authInfo.displayName)\r\n    ) {\r\n      history.replace(`/u/${encodeURIComponent(name)}`);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <header className=\"App-header\">\r\n      <Link className=\"App-title\" to=\"/\">\r\n        <h1>EARDRUM MONSTER</h1>\r\n      </Link>\r\n      {authInfo != null ? (\r\n        <>\r\n          {broadcastMatch == null ? (\r\n            <Link\r\n              className=\"App-link\"\r\n              to={`/u/${encodeURIComponent(authInfo.displayName)}`}\r\n            >\r\n              Host a channel\r\n            </Link>\r\n          ) : (\r\n            /* eslint-disable-next-line jsx-a11y/anchor-is-valid */\r\n            <a className=\"App-link\" href=\"#\" onClick={handleLogout}>\r\n              Logout\r\n            </a>\r\n          )}\r\n          <div className=\"App-headerPhoto\">\r\n            {editing ? (\r\n              <ChangeUsername\r\n                initialVal={authInfo.displayName}\r\n                onSuccess={(name) => updateName(name)}\r\n                onCancel={() => setEditing(false)}\r\n              />\r\n            ) : (\r\n              <span className=\"App-smallLink\">\r\n                {authInfo.displayName}{\" \"}\r\n                {/* eslint-disable-next-line jsx-a11y/anchor-is-valid */}\r\n                <a\r\n                  className=\"App-smallLink\"\r\n                  href=\"#\"\r\n                  onClick={(e) => {\r\n                    e.preventDefault();\r\n                    setEditing(true);\r\n                  }}\r\n                >\r\n                  edit\r\n                </a>\r\n              </span>\r\n            )}\r\n            {authInfo.userImg ? (\r\n              <img\r\n                className=\"App-headerImg\"\r\n                src={authInfo.userImg}\r\n                alt=\"profile pic\"\r\n              />\r\n            ) : (\r\n              authInfo.displayName\r\n            )}\r\n          </div>\r\n        </>\r\n      ) : (\r\n        <a className=\"App-link\" href={authorizeURI}>\r\n          Host a channel\r\n        </a>\r\n      )}\r\n    </header>\r\n  );\r\n}\r\n\r\nexport default Header;\r\n","import React from \"react\";\r\nimport { API, graphqlOperation } from \"aws-amplify\";\r\nimport * as mutations from \"./graphql/mutations\";\r\n\r\nexport default function DevPublisher({ hostUserID }) {\r\n  React.useEffect(() => {\r\n    const timeoutID = setInterval(() => {\r\n      const tracks = [\r\n        \"spotify:track:08KMh61hPslT7sEf2tEgtT\",\r\n        \"spotify:track:4mFDsq9pt9msJ9ywYvBzHo\",\r\n        \"spotify:track:59nNxS2V7M4UDH058BU5qJ\",\r\n        \"spotify:track:1CkrhTdtRhUzPmA8qtr6y6\",\r\n        \"spotify:track:4mFDsq9pt9msJ9ywYvBzHo\",\r\n        \"spotify:track:6AynxUt8LJy9S6bovDdFLr\",\r\n        \"spotify:track:000PzErbB04ALQCv9iYiQm\",\r\n        \"spotify:track:6AynxUt8LJy9S6bovDdFLr\",\r\n        \"spotify:track:7JGepQzDnQDYeGxLCTBSsG\",\r\n        \"spotify:track:4PPrsYpzuRqe4QoCDGAG4b\",\r\n      ];\r\n      const songEvent = {\r\n        userID: hostUserID,\r\n        timestamp: Math.floor(Date.now() / 1000),\r\n        position: 0,\r\n        spotifyURI: tracks[(Math.random() * 100).toString()[0]],\r\n        type: \"NEW_SONG\",\r\n      };\r\n      API.graphql(\r\n        graphqlOperation(mutations.updateUser, {\r\n          input: {\r\n            userID: hostUserID,\r\n            latestSongEvent: Math.floor(Date.now() / 1000),\r\n          },\r\n        })\r\n      );\r\n      API.graphql(\r\n        graphqlOperation(mutations.createSongEvent, { input: songEvent })\r\n      ).then((data) => console.log(\"Publishing: \", data));\r\n    }, 5000);\r\n\r\n    return () => {\r\n      clearInterval(timeoutID);\r\n    };\r\n  }, [hostUserID]);\r\n\r\n  return <h1>DevPublisher enabled</h1>;\r\n}\r\n","export default class SpotifyWebPlayer {\r\n  constructor(player, spotifyAPI) {\r\n    this.player = player;\r\n    this.spotifyAPI = spotifyAPI;\r\n  }\r\n\r\n  fetchState() {\r\n    return this.player.getCurrentState();\r\n  }\r\n\r\n  pause() {\r\n    return this.player.pause();\r\n  }\r\n\r\n  resume() {\r\n    return this.player.resume();\r\n  }\r\n\r\n  seek(ms) {\r\n    return this.player.seek(ms);\r\n  }\r\n\r\n  nextTrack() {\r\n    return this.player.nextTrack();\r\n  }\r\n\r\n  addStateChangeListener(callback) {\r\n    this.player.addListener(\"player_state_changed\", callback);\r\n  }\r\n\r\n  removeStateChangeListener(callback) {\r\n    this.player.removeListener(\"player_state_changed\", callback);\r\n  }\r\n\r\n  getDeviceID() {\r\n    return this.player.deviceID;\r\n  }\r\n\r\n  transferPlayback() {\r\n    return this.spotifyAPI.transferPlayback(this.player.deviceID);\r\n  }\r\n\r\n  static inject() {\r\n    return new Promise((resolve) => {\r\n      if (window?.Spotify?.Player) {\r\n        resolve();\r\n        return;\r\n      }\r\n      window.onSpotifyWebPlaybackSDKReady = () => {\r\n        resolve();\r\n      };\r\n      const sdkScript = document.createElement(\"script\");\r\n      sdkScript.src = process.env.REACT_APP_SPOTIFY_WEB_PLAYER_SDK;\r\n      document.body.appendChild(sdkScript);\r\n    });\r\n  }\r\n\r\n  static initializePlayer(spotifyAPI, accessToken, onUnauthorized) {\r\n    // Update accessToken singleton so existing players can access it;\r\n    SpotifyWebPlayer.__accessToken = accessToken;\r\n    SpotifyWebPlayer.__onUnauthorized = onUnauthorized;\r\n    SpotifyWebPlayer.__spotifyAPI = spotifyAPI;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      if (window.EMGlobalPlayerInstance != null) {\r\n        resolve(window.EMGlobalPlayerInstance);\r\n        return;\r\n      }\r\n\r\n      let volumeRef = {\r\n        current:\r\n          window.localStorage.getItem(\"EMPlayerVolume\") ?? (0.1).toFixed(2),\r\n      };\r\n      const player = new window.Spotify.Player({\r\n        name: \"eardrum.monster\",\r\n        getOAuthToken: (cb) => {\r\n          cb(SpotifyWebPlayer.__accessToken);\r\n          SpotifyWebPlayer.__spotifyAPI.fetchUserInfo();\r\n        },\r\n        volume: volumeRef.current,\r\n      });\r\n\r\n      // Update volume on change\r\n      setInterval(() => {\r\n        player.getVolume().then((newVolume) => {\r\n          if (typeof newVolume === \"number\") {\r\n            const newVol = newVolume.toFixed(2);\r\n            if (newVol > 0 && volumeRef.current !== newVol) {\r\n              volumeRef.current = newVol;\r\n              window.localStorage.setItem(\"EMPlayerVolume\", newVol);\r\n            }\r\n          }\r\n        });\r\n      }, 5000);\r\n\r\n      player.on(\"initialization_error\", ({ message }) => {\r\n        console.error(\"Failed to initialize\", message);\r\n        reject(\"initialization_error\");\r\n      });\r\n      player.on(\"authentication_error\", ({ message }) => {\r\n        console.error(\"Failed to authenticate\", message);\r\n        SpotifyWebPlayer.__onUnauthorized();\r\n      });\r\n      player.on(\"account_error\", ({ message }) => {\r\n        console.error(\"Spotify premium required\", message);\r\n        reject(\"premium_required\");\r\n      });\r\n      player.on(\"playback_error\", ({ message }) => {\r\n        console.error(\"Failed to perform playback\", message);\r\n        reject(\"playback_error\");\r\n      });\r\n      player.on(\"ready\", ({ device_id: id }) => {\r\n        player.deviceID = id;\r\n        window.EMGlobalPlayerInstance = player;\r\n        resolve(player);\r\n      });\r\n\r\n      player\r\n        .connect()\r\n        .then((success) => {\r\n          if (!success) {\r\n            console.error(\"Failed to connect to the web player\");\r\n          }\r\n        })\r\n        .catch(() => {\r\n          reject();\r\n        });\r\n    });\r\n  }\r\n\r\n  static createInstance(accessToken, spotifyAPI, onUnauthorized) {\r\n    return SpotifyWebPlayer.inject()\r\n      .then(() =>\r\n        SpotifyWebPlayer.initializePlayer(\r\n          spotifyAPI,\r\n          accessToken,\r\n          onUnauthorized\r\n        )\r\n      )\r\n      .then((player) => new SpotifyWebPlayer(player, spotifyAPI));\r\n  }\r\n\r\n  static getTrackFromState(state) {\r\n    return state?.track_window?.current_track;\r\n  }\r\n}\r\n","import React, { createContext } from \"react\";\r\nimport SpotifyAPI from \"./SpotifyAPI.js\";\r\nimport SpotifyWebPlayer from \"./SpotifyWebPlayer.js\";\r\nimport useAuth from \"./useAuth\";\r\nimport { useHistory } from \"react-router-dom\";\r\n\r\ntype SpotifyContextType = {\r\n  webPlayer: SpotifyWebPlayer | null;\r\n  webPlayerUnsupported: boolean;\r\n  spotifyAPI: SpotifyAPI | null;\r\n  lastMutationTimestamp: number | null;\r\n  setLastMutationTimestamp: (time: number) => void;\r\n};\r\n\r\nexport const SpotifyContext = createContext<SpotifyContextType>({\r\n  webPlayer: null,\r\n  webPlayerUnsupported: false,\r\n  spotifyAPI: null,\r\n  lastMutationTimestamp: null,\r\n  setLastMutationTimestamp: () => {},\r\n});\r\n\r\nexport function SpotifyProvider({\r\n  children,\r\n}: {\r\n  children: React.ReactChildren;\r\n}) {\r\n  const authInfo = useAuth();\r\n  const history = useHistory();\r\n  const [webPlayer, setWebPlayer] = React.useState<null | SpotifyWebPlayer>(\r\n    null\r\n  );\r\n  const [webPlayerUnsupported, setWebPlayerUnsupported] = React.useState(false);\r\n  const [spotifyAPI, setSpotifyAPI] = React.useState<null | SpotifyAPI>(null);\r\n  const [lastMutationTimestamp, setLastMutationTimestamp] = React.useState<\r\n    null | number\r\n  >(null);\r\n\r\n  React.useEffect(() => {\r\n    if (authInfo == null) {\r\n      setWebPlayer(null);\r\n      setSpotifyAPI(null);\r\n    } else {\r\n      const api = new SpotifyAPI(authInfo.accessToken, authInfo.retryAuth);\r\n      setSpotifyAPI(api);\r\n      SpotifyWebPlayer.createInstance(\r\n        authInfo.accessToken,\r\n        api,\r\n        authInfo.retryAuth\r\n      )\r\n        .then((inst) => {\r\n          setWebPlayer(inst);\r\n        })\r\n        .catch((error) => {\r\n          switch (error) {\r\n            case \"premium_required\": {\r\n              history.replace(\"/premium_required\");\r\n              break;\r\n            }\r\n            case \"initialization_error\":\r\n            case \"playback_error\":\r\n            default: {\r\n              setWebPlayer(null);\r\n              setWebPlayerUnsupported(true);\r\n            }\r\n          }\r\n        });\r\n    }\r\n  }, [authInfo, history]);\r\n\r\n  const spotifyContext = React.useMemo(\r\n    () => ({\r\n      webPlayer,\r\n      webPlayerUnsupported,\r\n      spotifyAPI,\r\n      lastMutationTimestamp,\r\n      setLastMutationTimestamp,\r\n    }),\r\n    [webPlayer, spotifyAPI, lastMutationTimestamp, webPlayerUnsupported]\r\n  );\r\n\r\n  return (\r\n    <SpotifyContext.Provider value={spotifyContext}>\r\n      {children}\r\n    </SpotifyContext.Provider>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport { SpotifyContext } from \"./SpotifyContext\";\r\n\r\nexport default function useSpotifyAPI() {\r\n  const spotifyContext = React.useContext(SpotifyContext);\r\n  return spotifyContext?.spotifyAPI;\r\n}\r\n","import React from \"react\";\r\nimport { SpotifyContext } from \"./SpotifyContext\";\r\n\r\nexport function useSpotifyWebPlayerUnsupported() {\r\n  const spotifyContext = React.useContext(SpotifyContext);\r\n  return spotifyContext.webPlayerUnsupported;\r\n}\r\n\r\nexport default function useSpotifyWebPlayer() {\r\n  const spotifyContext = React.useContext(SpotifyContext);\r\n  return spotifyContext?.webPlayer;\r\n}\r\n","import React from \"react\";\r\nimport useSpotifyAPI from \"./useSpotifyAPI.js\";\r\nimport useSpotifyWebPlayer from \"./useSpotifyWebPlayer.js\";\r\n\r\nexport default function SongPlayerWithControls({ song }) {\r\n  const spotifyAPI = useSpotifyAPI();\r\n  const spotifyWebPlayer = useSpotifyWebPlayer();\r\n  const [devices, setDevices] = React.useState(null);\r\n  const [activeDeviceID, setActiveDeviceID] = React.useState(null);\r\n  const activeDeviceIDRef = React.useRef(null);\r\n  const [isReady, setIsReady] = React.useState(false);\r\n  activeDeviceIDRef.current = activeDeviceID;\r\n\r\n  const eardrumPlayer = spotifyWebPlayer && {\r\n    id: spotifyWebPlayer.getDeviceID(),\r\n    name: \"eardrum.monster\",\r\n  };\r\n  const deviceList = devices ?? [];\r\n  if (\r\n    eardrumPlayer != null &&\r\n    !deviceList.find((d) => d.id === eardrumPlayer.id)\r\n  ) {\r\n    deviceList.push(eardrumPlayer);\r\n  }\r\n\r\n  // Fetch devices\r\n  React.useEffect(() => {\r\n    spotifyAPI &&\r\n      spotifyAPI.fetchDevices().then((data) => {\r\n        setDevices(data.devices);\r\n      });\r\n  }, [spotifyAPI]);\r\n\r\n  // Use web player if there is no active device\r\n  React.useEffect(() => {\r\n    if (spotifyAPI && devices) {\r\n      const activeDevice = devices.find((device) => device.is_active === true);\r\n      if (activeDevice) {\r\n        setActiveDeviceID(activeDevice.id);\r\n        setIsReady(true);\r\n      } else if (spotifyWebPlayer) {\r\n        setActiveDeviceID(spotifyWebPlayer.getDeviceID());\r\n        setIsReady(true);\r\n      }\r\n    }\r\n  }, [spotifyAPI, devices, spotifyWebPlayer]);\r\n\r\n  React.useEffect(() => {\r\n    activeDeviceIDRef.current &&\r\n      isReady &&\r\n      spotifyAPI &&\r\n      spotifyAPI.play(song.spotifyURI, activeDeviceIDRef.current);\r\n  }, [spotifyAPI, song, isReady]);\r\n\r\n  const handleChange = (event) => {\r\n    const deviceID = event.target.value;\r\n    spotifyAPI.transferPlayback(deviceID);\r\n    setActiveDeviceID(deviceID);\r\n  };\r\n\r\n  return (\r\n    <div className=\"Listen-controls\">\r\n      <div>Playing on device:</div>\r\n      <select value={activeDeviceID ?? \"\"} onChange={handleChange}>\r\n        {deviceList?.map((device) => (\r\n          <option key={device.id} value={device.id}>\r\n            {device.name}\r\n          </option>\r\n        ))}\r\n      </select>\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport \"./Track.css\";\r\nimport logo from \"./logo.png\";\r\n\r\nfunction Track({ track }) {\r\n  return (\r\n    <div className=\"Track\">\r\n      <img\r\n        className=\"Track-albumImg\"\r\n        src={track?.albumImg ?? logo}\r\n        alt=\"Album art\"\r\n      />\r\n      <div className=\"Track-details\">\r\n        <p className=\"Track-name\">{track?.name ?? \"Unknown\"}</p>\r\n        <p className=\"Track-artist\">{track?.artistName}</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Track;\r\n","import React from \"react\";\nimport Track from \"./Track.js\";\nimport { SongEvent } from \"./Types.js\";\n\nexport default function TrackList({ songs }: { songs: SongEvent[] }) {\n  return (\n    <>\n      <h3>Recently played tracks</h3>\n      {songs.map((song) => {\n        if (song == null) {\n          return null;\n        }\n        return <Track track={song.track} key={song.id} />;\n      })}\n    </>\n  );\n}\n","import React from \"react\";\r\nimport \"./EQBars.css\";\r\n\r\nexport default function EQBars({ className }) {\r\n  return (\r\n    <div className={className}>\r\n      <div className=\"EQBars-container\">\r\n        <ol className=\"EQBars-column\">\r\n          <li className=\"colour-bar\"></li>\r\n        </ol>\r\n        <ol className=\"EQBars-column\">\r\n          <li className=\"colour-bar\"></li>\r\n        </ol>\r\n        <ol className=\"EQBars-column\">\r\n          <li className=\"colour-bar\"></li>\r\n        </ol>\r\n        <ol className=\"EQBars-column\">\r\n          <li className=\"colour-bar\"></li>\r\n        </ol>\r\n        <ol className=\"EQBars-column\">\r\n          <li className=\"colour-bar\"></li>\r\n        </ol>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport { Connect } from \"aws-amplify-react\";\r\nimport * as subscriptions from \"./graphql/subscriptions\";\r\nimport * as queries from \"./graphql/queries\";\r\nimport { graphqlOperation } from \"aws-amplify\";\r\nimport { getActiveListeners, isUserListening } from \"./Utils\";\r\nimport \"./Listeners.css\";\r\n\r\nimport type {\r\n  OnUpdateUserByListeningToSubscription,\r\n  UsersByListeningToQuery,\r\n} from \"./API\";\r\nimport type { User } from \"./Types\";\r\n\r\nexport default function Listeners({\r\n  hostUserID,\r\n  hostDisplayName,\r\n  hostUserImg,\r\n}: {\r\n  hostUserID: string;\r\n  hostDisplayName: string;\r\n  hostUserImg: string;\r\n}) {\r\n  const [rerender, setRerender] = React.useState(false);\r\n\r\n  // Re-render every 10s to update listeners\r\n  React.useEffect(() => {\r\n    const timeoutID = setTimeout(() => {\r\n      setRerender((r) => !r);\r\n    }, 10000);\r\n    return () => {\r\n      clearTimeout(timeoutID);\r\n    };\r\n  }, [rerender]);\r\n\r\n  return (\r\n    <div className=\"Listeners\">\r\n      <div className=\"Listeners-title\">Listeners</div>\r\n      <div className=\"Listeners-list\">\r\n        <Connect\r\n          query={graphqlOperation(queries.usersByListeningTo, {\r\n            listeningTo: hostUserID,\r\n            sortDirection: \"DESC\",\r\n            limit: 50,\r\n          })}\r\n          subscription={graphqlOperation(\r\n            subscriptions.onUpdateUserByListeningTo,\r\n            {\r\n              listeningTo: hostUserID,\r\n            }\r\n          )}\r\n          // @ts-ignore\r\n          onSubscriptionMsg={(\r\n            prev: UsersByListeningToQuery,\r\n            data: OnUpdateUserByListeningToSubscription\r\n          ) => {\r\n            const { onUpdateUserByListeningTo } = data;\r\n            const items = prev.usersByListeningTo?.items;\r\n            if (items == null || onUpdateUserByListeningTo == null) {\r\n              console.error(\"unexpected null Listeners\", prev);\r\n              return prev;\r\n            }\r\n            const index = items.findIndex(\r\n              (user) => user && user.userID === onUpdateUserByListeningTo.userID\r\n            );\r\n            const isListening = isUserListening(onUpdateUserByListeningTo);\r\n            let wasListening = isUserListening(items[index] as User);\r\n            if (index >= 0) {\r\n              items[index] = onUpdateUserByListeningTo;\r\n            } else {\r\n              items.push(onUpdateUserByListeningTo);\r\n            }\r\n            if (isListening && !wasListening) {\r\n              const audio = new Audio(process.env.PUBLIC_URL + \"/notif.wav\");\r\n              audio.volume = 0.2;\r\n              audio.play();\r\n            }\r\n            return prev;\r\n          }}\r\n        >\r\n          {({ data, loading, error }: any) => {\r\n            if (error) return <h3>Error</h3>;\r\n            if (loading || !data) return <h3>Loading...</h3>;\r\n            const users =\r\n              (data.usersByListeningTo && data.usersByListeningTo.items) ?? [];\r\n            const onlineUsers = getActiveListeners(users);\r\n            return (\r\n              <>\r\n                <div className=\"Listeners-item\">\r\n                  {hostUserImg && (\r\n                    <img\r\n                      className=\"Listeners-userImg\"\r\n                      src={hostUserImg}\r\n                      alt={`Profile Pic`}\r\n                    />\r\n                  )}\r\n                  {/* eslint-disable-next-line jsx-a11y/accessible-emoji */}\r\n                  <div>{hostDisplayName} ⭐</div>\r\n                </div>\r\n                {onlineUsers.map((user) => {\r\n                  if (user == null) {\r\n                    return null;\r\n                  }\r\n                  return (\r\n                    <div className=\"Listeners-item\" key={user.userID}>\r\n                      {user?.userImg && (\r\n                        <img\r\n                          className=\"Listeners-userImg\"\r\n                          src={user?.userImg}\r\n                          alt={`Profile Pic`}\r\n                        />\r\n                      )}\r\n                      <span>{user.displayName || user.userID}</span>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </>\r\n            );\r\n          }}\r\n        </Connect>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","// tslint:disable\r\n// eslint-disable\r\n// this is an auto generated file. This will be overwritten\r\n\r\nexport const onCreateSongEvent = /* GraphQL */ `\r\n  subscription OnCreateSongEvent($userID: String!) {\r\n    onCreateSongEvent(userID: $userID) {\r\n      id\r\n      spotifyURI\r\n      timestamp\r\n      position\r\n      track {\r\n        uri\r\n        trackID\r\n        name\r\n        durationMs\r\n        albumName\r\n        artistName\r\n        albumImg\r\n      }\r\n      userID\r\n      user {\r\n        userID\r\n        latestSongEvent\r\n        latestListenPing\r\n        listeningTo\r\n        songEvents {\r\n          items {\r\n            id\r\n            spotifyURI\r\n            timestamp\r\n            position\r\n            userID\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        listeners {\r\n          items {\r\n            userID\r\n            latestSongEvent\r\n            latestListenPing\r\n            listeningTo\r\n            displayName\r\n            userImg\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        displayName\r\n        userImg\r\n        type\r\n      }\r\n      type\r\n    }\r\n  }\r\n`;\r\nexport const onUpdateUserByListeningTo = /* GraphQL */ `\r\n  subscription OnUpdateUserByListeningTo($listeningTo: String) {\r\n    onUpdateUserByListeningTo(listeningTo: $listeningTo) {\r\n      userID\r\n      latestSongEvent\r\n      latestListenPing\r\n      listeningTo\r\n      songEvents {\r\n        items {\r\n          id\r\n          spotifyURI\r\n          timestamp\r\n          position\r\n          track {\r\n            uri\r\n            trackID\r\n            name\r\n            durationMs\r\n            albumName\r\n            artistName\r\n            albumImg\r\n          }\r\n          userID\r\n          user {\r\n            userID\r\n            latestSongEvent\r\n            latestListenPing\r\n            listeningTo\r\n            displayName\r\n            userImg\r\n            type\r\n          }\r\n          type\r\n        }\r\n        nextToken\r\n      }\r\n      listeners {\r\n        items {\r\n          userID\r\n          latestSongEvent\r\n          latestListenPing\r\n          listeningTo\r\n          songEvents {\r\n            nextToken\r\n          }\r\n          listeners {\r\n            nextToken\r\n          }\r\n          displayName\r\n          userImg\r\n          type\r\n        }\r\n        nextToken\r\n      }\r\n      displayName\r\n      userImg\r\n      type\r\n    }\r\n  }\r\n`;\r\nexport const onUpdateUserByUserId = /* GraphQL */ `\r\n  subscription OnUpdateUserByUserId($userID: String) {\r\n    onUpdateUserByUserID(userID: $userID) {\r\n      userID\r\n      latestSongEvent\r\n      latestListenPing\r\n      listeningTo\r\n      songEvents {\r\n        items {\r\n          id\r\n          spotifyURI\r\n          timestamp\r\n          position\r\n          track {\r\n            uri\r\n            trackID\r\n            name\r\n            durationMs\r\n            albumName\r\n            artistName\r\n            albumImg\r\n          }\r\n          userID\r\n          user {\r\n            userID\r\n            latestSongEvent\r\n            latestListenPing\r\n            listeningTo\r\n            displayName\r\n            userImg\r\n            type\r\n          }\r\n          type\r\n        }\r\n        nextToken\r\n      }\r\n      listeners {\r\n        items {\r\n          userID\r\n          latestSongEvent\r\n          latestListenPing\r\n          listeningTo\r\n          songEvents {\r\n            nextToken\r\n          }\r\n          listeners {\r\n            nextToken\r\n          }\r\n          displayName\r\n          userImg\r\n          type\r\n        }\r\n        nextToken\r\n      }\r\n      displayName\r\n      userImg\r\n      type\r\n    }\r\n  }\r\n`;\r\nexport const onCreateTrack = /* GraphQL */ `\r\n  subscription OnCreateTrack {\r\n    onCreateTrack {\r\n      uri\r\n      trackID\r\n      name\r\n      durationMs\r\n      albumName\r\n      artistName\r\n      albumImg\r\n    }\r\n  }\r\n`;\r\nexport const onUpdateTrack = /* GraphQL */ `\r\n  subscription OnUpdateTrack {\r\n    onUpdateTrack {\r\n      uri\r\n      trackID\r\n      name\r\n      durationMs\r\n      albumName\r\n      artistName\r\n      albumImg\r\n    }\r\n  }\r\n`;\r\nexport const onDeleteTrack = /* GraphQL */ `\r\n  subscription OnDeleteTrack {\r\n    onDeleteTrack {\r\n      uri\r\n      trackID\r\n      name\r\n      durationMs\r\n      albumName\r\n      artistName\r\n      albumImg\r\n    }\r\n  }\r\n`;\r\n","import React from \"react\";\r\nimport Switch from \"react-switch\";\r\nimport { hasTouchScreen } from \"./Utils\";\r\n\r\nexport default function WakeLockControl() {\r\n  const [wlEnabled, setwlEnabled] = React.useState(false);\r\n  const NoSleep = (window as Window & typeof globalThis & { NoSleep: any })\r\n    .NoSleep;\r\n  const noSleepRef = React.useRef<any>(null);\r\n\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (noSleepRef.current != null) {\r\n        noSleepRef.current.disable();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const handleChange = React.useCallback(\r\n    (enabled) => {\r\n      setwlEnabled(enabled);\r\n      if (enabled && NoSleep != null) {\r\n        noSleepRef.current = new NoSleep();\r\n        noSleepRef.current.enable();\r\n      } else {\r\n        noSleepRef.current.disable();\r\n      }\r\n    },\r\n    [setwlEnabled, NoSleep]\r\n  );\r\n\r\n  if (NoSleep == null || !hasTouchScreen()) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className=\"Broadcast-controls\">\r\n        <label htmlFor=\"wlToggle\">Prevent screen lock</label>\r\n        <Switch\r\n          className=\"Broadcast-switch\"\r\n          id=\"wlToggle\"\r\n          onChange={handleChange}\r\n          checked={wlEnabled}\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","import React from \"react\";\nimport { API, graphqlOperation } from \"aws-amplify\";\nimport { Connect } from \"aws-amplify-react\";\nimport \"./Listen.css\";\nimport DevPublisher from \"./DevPublisher.js\";\nimport { AuthContext, getAuthorizeURI } from \"./Auth.js\";\nimport SongPlayerWithControls from \"./SongPlayerWithControls.js\";\nimport TrackList from \"./TrackList\";\nimport Track from \"./Track.js\";\nimport EQBars from \"./EQBars.js\";\nimport { useLocation, useHistory } from \"react-router-dom\";\nimport { useLocalStorage } from \"@rehooks/local-storage\";\nimport Listeners from \"./Listeners\";\nimport { isUserOnline } from \"./Utils\";\nimport WakeLockControl from \"./WakeLockControl\";\n\nimport * as queries from \"./graphql/queries\";\nimport * as subscriptions from \"./graphql/subscriptions\";\nimport * as mutations from \"./graphql/mutations\";\n\nfunction createUserObservable(hostUserID) {\n  return API.graphql(\n    graphqlOperation(subscriptions.onUpdateUserByUserId, {\n      userID: hostUserID,\n    })\n  );\n}\n\nfunction StartListening({ children, isListening, onClick }) {\n  const location = useLocation();\n  const authInfo = React.useContext(AuthContext);\n\n  if (isListening) {\n    return children;\n  }\n\n  return (\n    <div className=\"Listen-startListening\">\n      <div className=\"Listen-startListeningMask\">{children}</div>\n      <div className=\"Listen-startListeningContent\">\n        <EQBars className=\"Listen-EQ\" />\n      </div>\n      <div className=\"Listen-startListeningContent\">\n        <a className=\"Listen-play\" href={location.pathname} onClick={onClick}>\n          {/* eslint-disable-next-line jsx-a11y/accessible-emoji */}\n          👂\n          <span className=\"Listen-playLink\">\n            {authInfo == null ? \"Login to join ▶\" : \"Join ▶\"}\n          </span>\n          {/* eslint-disable-next-line jsx-a11y/accessible-emoji */}\n          😈\n        </a>\n      </div>\n    </div>\n  );\n}\n\nfunction publishListenPing(userID, hostUserID) {\n  return API.graphql(\n    graphqlOperation(mutations.updateUser, {\n      input: {\n        userID,\n        latestListenPing: Math.floor(Date.now() / 1000),\n        listeningTo: hostUserID,\n      },\n    })\n  );\n}\n\nfunction ListenPlayer({ isCurrentlyLive, songs, hostUserID, hostDisplayName }) {\n  const authInfo = React.useContext(AuthContext);\n  const location = useLocation();\n  const [isListeningUsername, setIsListeningUsername] = useLocalStorage(\n    \"EMisListeningUsername\"\n  );\n  const isListening = authInfo && hostUserID === String(isListeningUsername);\n  const NoSleep = window.NoSleep;\n\n  React.useEffect(() => {\n    if (isListening && NoSleep != null) {\n      const noSleep = new NoSleep();\n      noSleep.enable();\n      return () => noSleep.disable();\n    }\n  }, [isListening, NoSleep]);\n\n  React.useEffect(() => {\n    if (isListening && authInfo) {\n      publishListenPing(authInfo.username, hostUserID);\n      const intervalID = setInterval(() => {\n        publishListenPing(authInfo.username, hostUserID);\n      }, 10000);\n      return () => clearInterval(intervalID);\n    }\n  }, [isListening, authInfo, hostUserID]);\n\n  const handleJoin = React.useCallback(\n    (e) => {\n      e.preventDefault();\n      setIsListeningUsername(hostUserID);\n      if (authInfo == null) {\n        window.location.href = getAuthorizeURI(location.pathname);\n      }\n    },\n    [setIsListeningUsername, authInfo, location, hostUserID]\n  );\n\n  if (!isCurrentlyLive) {\n    return <h1>offline</h1>;\n  }\n\n  return (\n    <StartListening isListening={isListening} onClick={handleJoin}>\n      {isListening && <p>Listening to {hostDisplayName}'s channel!</p>}\n      {isListening && <SongPlayerWithControls song={songs[0]} />}\n      {isListening && <WakeLockControl />}\n      <div>Now Playing:</div>\n      <Track track={songs[0].track} />\n    </StartListening>\n  );\n}\n\nfunction Listen({ hostDisplayName, hostUserID, hostUserImg }) {\n  const location = useLocation();\n  const history = useHistory();\n  const devPublisherEnabled = location.search.includes(\"DEV=1\");\n\n  // Setup host subscription\n  React.useEffect(() => {\n    const obs = createUserObservable(hostUserID);\n    const sub = obs.subscribe({\n      next: (event) => {\n        if (event) {\n          const newHostDisplayName =\n            event.value.data.onUpdateUserByUserID?.displayName;\n          if (\n            newHostDisplayName != null &&\n            newHostDisplayName !== hostDisplayName\n          ) {\n            history.replace(`/u/${encodeURIComponent(newHostDisplayName)}`);\n          }\n        }\n      },\n    });\n    return () => {\n      sub.unsubscribe();\n    };\n  }, [hostUserID, hostDisplayName, history]);\n\n  return (\n    <div className=\"Listen\">\n      <Connect\n        query={graphqlOperation(queries.songEventsByUserId, {\n          userID: hostUserID,\n          sortDirection: \"DESC\",\n          limit: 50,\n        })}\n        subscription={graphqlOperation(subscriptions.onCreateSongEvent, {\n          userID: hostUserID,\n        })}\n        onSubscriptionMsg={(prev, { onCreateSongEvent }) => {\n          if (prev?.songEventsByUserID?.items == null) {\n            console.error(\"bad state in listen\", prev);\n            return prev;\n          }\n          prev.songEventsByUserID.items.unshift(onCreateSongEvent);\n          if (prev.songEventsByUserID.items.length > 50) {\n            prev.songEventsByUserID.items.pop();\n          }\n          return prev;\n        }}\n      >\n        {({ data, loading, error }) => {\n          if (error) return <h3>Error</h3>;\n          if (loading || !data) return <h3>Loading...</h3>;\n          const songs =\n            (data.songEventsByUserID && data.songEventsByUserID.items) ?? [];\n          const online = songs.length > 0 && isUserOnline(songs[0].user);\n\n          return (\n            <>\n              {online && (\n                <div className=\"Listen-listeners\">\n                  <Listeners\n                    hostUserID={hostUserID}\n                    hostDisplayName={hostDisplayName}\n                    hostUserImg={hostUserImg}\n                  />\n                </div>\n              )}\n              <div className=\"Listen-trackList\">\n                <div className=\"Listen-header\">\n                  {hostDisplayName}'s Channel\n                  {devPublisherEnabled && (\n                    <DevPublisher hostUserID={hostUserID} />\n                  )}\n                </div>\n                <>\n                  <ListenPlayer\n                    isCurrentlyLive={online}\n                    songs={songs}\n                    hostDisplayName={hostDisplayName}\n                    hostUserID={hostUserID}\n                  />\n                  <TrackList songs={online ? songs.slice(1) : songs} />\n                </>\n              </div>\n            </>\n          );\n        }}\n      </Connect>\n    </div>\n  );\n}\n\nexport default Listen;\n","import React from \"react\";\r\nimport { SpotifyContext } from \"./SpotifyContext\";\r\n\r\nexport default function useSpotifyContext() {\r\n  const spotifyContext = React.useContext(SpotifyContext);\r\n  return spotifyContext;\r\n}\r\n","import React from \"react\";\r\nimport useSpotifyAPI from \"./useSpotifyAPI\";\r\nimport useAuth from \"./useAuth\";\r\nimport useSpotifyContext from \"./useSpotifyContext\";\r\n\r\nimport type { CreateSongEventInput, CreateTrackInput } from \"./API\";\r\nimport type { CurrentlyPlayingResponse } from \"./SpotifyAPITypes\";\r\n\r\nexport type BroadcastPublisherProps = {\r\n  onSongEvent: (\r\n    trackInput: CreateTrackInput,\r\n    songEventInput: CreateSongEventInput\r\n  ) => void;\r\n};\r\n\r\nexport default function BroadcastPollingPublisher({\r\n  onSongEvent,\r\n}: BroadcastPublisherProps) {\r\n  const authInfo = useAuth();\r\n  const spotifyAPI = useSpotifyAPI();\r\n  const handlePlayerStateChangedRef = React.useRef<\r\n    (currentlyPlaying: CurrentlyPlayingResponse) => void\r\n  >(() => {});\r\n  const { lastMutationTimestamp } = useSpotifyContext();\r\n\r\n  const handlePlayerStateChanged = (\r\n    currentlyPlaying: CurrentlyPlayingResponse\r\n  ) => {\r\n    const newTrack = currentlyPlaying?.item;\r\n    const isPlaying = currentlyPlaying?.is_playing ?? false;\r\n    if (newTrack == null || isPlaying === false || authInfo == null) {\r\n      return;\r\n    }\r\n    const track = {\r\n      uri: newTrack.uri,\r\n      trackID: newTrack.id,\r\n      name: newTrack.name,\r\n      durationMs: newTrack.duration_ms,\r\n      albumName: newTrack.album.name,\r\n      artistName: newTrack.artists[0].name,\r\n      albumImg: newTrack.album.images[0].url,\r\n    };\r\n    const songEvent = {\r\n      userID: authInfo.username,\r\n      timestamp: Math.floor(Date.now() / 1000),\r\n      position: Math.floor(currentlyPlaying?.progress_ms ?? 0),\r\n      spotifyURI: newTrack.uri,\r\n      type: \"NEW_SONG\",\r\n    };\r\n    onSongEvent(track, songEvent);\r\n  };\r\n  handlePlayerStateChangedRef.current = handlePlayerStateChanged;\r\n\r\n  React.useEffect(() => {\r\n    if (spotifyAPI) {\r\n      const timeoutIDRef: { current: NodeJS.Timeout | null } = {\r\n        current: null,\r\n      };\r\n      const fetchCurrentlyPlaying = () => {\r\n        spotifyAPI.fetchCurrentlyPlaying().then((currentlyPlayingResponse) => {\r\n          const progressMs = currentlyPlayingResponse?.progress_ms;\r\n          const durationMs = currentlyPlayingResponse?.item?.duration_ms;\r\n          // Poll more frequently earlier in the song\r\n          const timeoutDuration =\r\n            progressMs != null && durationMs != null && progressMs / 1000 < 30\r\n              ? 4000\r\n              : (durationMs - progressMs) / 1000 < 20\r\n              ? 3000\r\n              : 10000;\r\n          handlePlayerStateChangedRef.current(currentlyPlayingResponse);\r\n          timeoutIDRef.current = setTimeout(\r\n            fetchCurrentlyPlaying,\r\n            timeoutDuration\r\n          );\r\n        });\r\n      };\r\n      fetchCurrentlyPlaying();\r\n      return () => {\r\n        if (timeoutIDRef.current != null) {\r\n          clearTimeout(timeoutIDRef.current);\r\n        }\r\n      };\r\n    }\r\n  }, [spotifyAPI, lastMutationTimestamp, handlePlayerStateChangedRef]);\r\n\r\n  return null;\r\n}\r\n","import React from \"react\";\r\nimport useSpotifyWebPlayer from \"./useSpotifyWebPlayer\";\r\nimport SpotifyWebPlayer from \"./SpotifyWebPlayer\";\r\nimport useAuth from \"./useAuth\";\r\n\r\nimport type { CreateSongEventInput, CreateTrackInput } from \"./API\";\r\nimport type { SpotifyWebPlayerState } from \"./SpotifyWebPlayerTypes\";\r\n\r\nexport type BroadcastPublisherProps = {\r\n  onSongEvent: (\r\n    trackInput: CreateTrackInput,\r\n    songEventInput: CreateSongEventInput\r\n  ) => void;\r\n};\r\n\r\nexport default function BroadcastWebPlayerPublisher({\r\n  onSongEvent,\r\n}: BroadcastPublisherProps) {\r\n  const authInfo = useAuth();\r\n  const spotifyWebPlayer = useSpotifyWebPlayer();\r\n  const handlePlayerStateChangedRef = React.useRef<(newState: any) => void>(\r\n    () => {}\r\n  );\r\n\r\n  const handlePlayerStateChanged = (newState: SpotifyWebPlayerState) => {\r\n    const newTrack = SpotifyWebPlayer.getTrackFromState(newState);\r\n    // If there is not a valid track, dont publish\r\n    if (newTrack == null || authInfo == null) {\r\n      return;\r\n    }\r\n    const track = {\r\n      uri: newTrack.uri,\r\n      trackID: newTrack.id,\r\n      name: newTrack.name,\r\n      durationMs: newTrack.duration_ms,\r\n      albumName: newTrack.album.name,\r\n      artistName: newTrack.artists[0].name,\r\n      albumImg: newTrack.album.images[0].url,\r\n    };\r\n    const songEvent = {\r\n      userID: authInfo.username,\r\n      timestamp: Math.floor(Date.now() / 1000),\r\n      position: Math.floor(newState.position ?? 0),\r\n      spotifyURI: newTrack.uri,\r\n      type: \"NEW_SONG\",\r\n    };\r\n\r\n    onSongEvent(track, songEvent);\r\n  };\r\n  handlePlayerStateChangedRef.current = handlePlayerStateChanged;\r\n\r\n  React.useEffect(() => {\r\n    if (spotifyWebPlayer != null) {\r\n      const changeListener = (newState: any) =>\r\n        handlePlayerStateChangedRef.current(newState);\r\n      const initFunc = {\r\n        current: (id: any) => {\r\n          if (id === spotifyWebPlayer.getDeviceID()) {\r\n            // Request current state\r\n            spotifyWebPlayer.fetchState().then((newState: any) => {\r\n              handlePlayerStateChangedRef.current(newState);\r\n            });\r\n            spotifyWebPlayer.resume();\r\n          } else {\r\n            // Transfer playback to the web player\r\n            spotifyWebPlayer.transferPlayback();\r\n          }\r\n        },\r\n      };\r\n      // Subscribe to future changes\r\n      spotifyWebPlayer.addStateChangeListener(changeListener);\r\n\r\n      // get current state or transfer playback\r\n      spotifyWebPlayer.spotifyAPI.fetchCurrentDeviceID().then((id: any) => {\r\n        initFunc.current(id);\r\n      });\r\n\r\n      // Remove the listener on unMount\r\n      return () => {\r\n        spotifyWebPlayer.removeStateChangeListener(changeListener);\r\n        initFunc.current = () => {};\r\n        spotifyWebPlayer.pause();\r\n      };\r\n    }\r\n  }, [spotifyWebPlayer, handlePlayerStateChangedRef]);\r\n\r\n  return null;\r\n}\r\n","import React from \"react\";\r\nimport { API, graphqlOperation } from \"aws-amplify\";\r\nimport { GraphQLResult } from \"@aws-amplify/api-graphql\";\r\nimport * as mutations from \"./graphql/mutations\";\r\nimport useSpotifyWebPlayer, {\r\n  useSpotifyWebPlayerUnsupported,\r\n} from \"./useSpotifyWebPlayer\";\r\nimport useAuth from \"./useAuth\";\r\nimport BroadcastPollingPublisher from \"./BroadcastPollingPublisher\";\r\nimport BroadcastWebPlayerPublisher from \"./BroadcastWebPlayerPublisher\";\r\n\r\nimport type { CreateSongEventInput, CreateTrackInput } from \"./API\";\r\nimport type { SongEvent } from \"./Types\";\r\n\r\nexport type BroadcastPublisherProps = {\r\n  currentSongEvent: SongEvent;\r\n  onSongEvent: (songEvent: SongEvent) => void;\r\n};\r\n\r\nfunction publishSongEvent(songEvent: CreateSongEventInput) {\r\n  return API.graphql(\r\n    graphqlOperation(mutations.createSongEvent, {\r\n      input: songEvent,\r\n    })\r\n  );\r\n}\r\n\r\nfunction publishBroadcastPing(username: string) {\r\n  API.graphql(\r\n    graphqlOperation(mutations.updateUser, {\r\n      input: {\r\n        userID: username,\r\n        latestSongEvent: Math.floor(Date.now() / 1000),\r\n      },\r\n    })\r\n  );\r\n}\r\n\r\nfunction publishTrack(track: CreateTrackInput) {\r\n  return API.graphql(\r\n    graphqlOperation(mutations.createTrack, { input: track })\r\n  ) as Promise<GraphQLResult>;\r\n}\r\n\r\nexport default function BroadcastPublisher({\r\n  currentSongEvent,\r\n  onSongEvent,\r\n}: BroadcastPublisherProps) {\r\n  const authInfo = useAuth();\r\n  const spotifyWebPlayer = useSpotifyWebPlayer();\r\n  const webPlayerUnsupported = useSpotifyWebPlayerUnsupported();\r\n  const currentSongEventRef = React.useRef<SongEvent>(currentSongEvent);\r\n\r\n  const handleNewSongEvent = (\r\n    track: CreateTrackInput,\r\n    songEvent: CreateSongEventInput\r\n  ) => {\r\n    const isSameTrack =\r\n      songEvent.spotifyURI === currentSongEventRef.current?.spotifyURI;\r\n    if (isSameTrack) {\r\n      return;\r\n    }\r\n    const localSongEvent = {\r\n      __typename: \"SongEvent\" as \"SongEvent\",\r\n      ...songEvent,\r\n      track: {\r\n        __typename: \"Track\" as \"Track\",\r\n        ...track,\r\n      },\r\n      id: Math.random().toString(),\r\n      user: null,\r\n    };\r\n    currentSongEventRef.current = localSongEvent as SongEvent;\r\n    onSongEvent(localSongEvent as SongEvent);\r\n    publishTrack(track).then(() => {\r\n      publishSongEvent(songEvent);\r\n    });\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    if (authInfo) {\r\n      publishBroadcastPing(authInfo.username);\r\n      const intervalID = setInterval(() => {\r\n        publishBroadcastPing(authInfo.username);\r\n      }, 10000);\r\n      return () => clearInterval(intervalID);\r\n    }\r\n  }, [authInfo]);\r\n\r\n  if (spotifyWebPlayer) {\r\n    return <BroadcastWebPlayerPublisher onSongEvent={handleNewSongEvent} />;\r\n  }\r\n  if (webPlayerUnsupported) {\r\n    return <BroadcastPollingPublisher onSongEvent={handleNewSongEvent} />;\r\n  }\r\n  return null;\r\n}\r\n","import React from \"react\";\r\nimport Switch from \"react-switch\";\r\nimport useSpotifyAPI from \"./useSpotifyAPI\";\r\nimport { useLocalStorage } from \"@rehooks/local-storage\";\r\nimport useSpotifyContext from \"./useSpotifyContext\";\r\n\r\nexport default function PowerHourControl() {\r\n  const [phEnabled, setPhEnabled] = useLocalStorage(\"EMPhEnabled\", false);\r\n  const [phCount, setPhCount] = useLocalStorage(\"EMPhCount\", 1);\r\n  const spotifyAPI = useSpotifyAPI();\r\n  const phCallbackRef = React.useRef();\r\n  const { setLastMutationTimestamp } = useSpotifyContext();\r\n\r\n  const nextTrack = React.useCallback(() => {\r\n    spotifyAPI\r\n      .nextTrack()\r\n      .then(() => {\r\n        setLastMutationTimestamp(Date.now());\r\n      })\r\n      .catch(() => {\r\n        console.error(\"error playing next track\");\r\n      });\r\n  }, [spotifyAPI, setLastMutationTimestamp]);\r\n\r\n  const phCallback = (timeoutID) => {\r\n    if (phEnabled) {\r\n      setPhCount(phCount + 1);\r\n      nextTrack();\r\n    } else {\r\n      clearInterval(timeoutID);\r\n    }\r\n  };\r\n  phCallbackRef.current = phCallback;\r\n\r\n  const handleChange = React.useCallback(\r\n    (enabled) => {\r\n      setPhEnabled(enabled);\r\n      if (enabled) {\r\n        setPhCount(1);\r\n        if (spotifyAPI) {\r\n          nextTrack();\r\n        }\r\n      }\r\n    },\r\n    [setPhEnabled, setPhCount, spotifyAPI, nextTrack]\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    if (phEnabled) {\r\n      const timeoutID = setInterval(() => {\r\n        phCallbackRef.current(timeoutID);\r\n      }, 60000);\r\n      return () => {\r\n        clearInterval(timeoutID);\r\n      };\r\n    }\r\n  }, [phEnabled, phCallbackRef]);\r\n\r\n  return (\r\n    <>\r\n      <div className=\"Broadcast-controls\">\r\n        <label htmlFor=\"phToggle\">Power hour mode</label>\r\n        <Switch\r\n          className=\"Broadcast-switch\"\r\n          id=\"phToggle\"\r\n          onChange={handleChange}\r\n          checked={phEnabled}\r\n        />\r\n      </div>\r\n      {phEnabled && <h1>{phCount}</h1>}\r\n    </>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport useAuth from \"./useAuth\";\r\nimport ChangeUsername from \"./ChangeUsername\";\r\nimport { useHistory } from \"react-router-dom\";\r\n\r\nexport default function BroadcastHeading({\r\n  hostDisplayName,\r\n}: {\r\n  hostDisplayName: string;\r\n}) {\r\n  const authInfo = useAuth();\r\n  const history = useHistory();\r\n  const [editing, setEditing] = React.useState(false);\r\n\r\n  if (authInfo == null || authInfo.displayName !== hostDisplayName) {\r\n    return `${hostDisplayName}'s Channel`;\r\n  }\r\n\r\n  const nameUpdated = (name: string) => {\r\n    setEditing(false);\r\n    history.replace(`/u/${encodeURIComponent(name)}`);\r\n  };\r\n\r\n  if (!editing) {\r\n    return (\r\n      <div className=\"Broadcast-heading\">\r\n        <div className=\"Broadcast-headingTitle\">\r\n          {hostDisplayName}'s Channel\r\n        </div>\r\n        <button onClick={() => setEditing(true)}>Edit</button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"Broadcast-heading\">\r\n      <ChangeUsername\r\n        initialVal={hostDisplayName}\r\n        onSuccess={(name) => nameUpdated(name)}\r\n        onCancel={() => setEditing(false)}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\nimport { API, graphqlOperation } from \"aws-amplify\";\nimport * as queries from \"./graphql/queries\";\nimport useSpotifyWebPlayer, {\n  useSpotifyWebPlayerUnsupported,\n} from \"./useSpotifyWebPlayer\";\nimport Track from \"./Track.js\";\nimport TrackList from \"./TrackList\";\nimport \"./Broadcast.css\";\nimport { AuthContext } from \"./Auth.js\";\nimport BroadcastPublisher from \"./BroadcastPublisher\";\nimport PowerHourControl from \"./PowerHourControl.js\";\nimport EQBars from \"./EQBars.js\";\nimport Listeners from \"./Listeners\";\nimport { CopyToClipboard } from \"react-copy-to-clipboard\";\nimport BroadcastHeading from \"./BroadcastHeading\";\nimport WakeLockControl from \"./WakeLockControl\";\n\nfunction Broadcast() {\n  const authInfo = React.useContext(AuthContext);\n  const [songHistory, setSongHistory] = React.useState(null);\n  const spotifyWebPlayer = useSpotifyWebPlayer();\n  const webPlayerUnsupported = useSpotifyWebPlayerUnsupported();\n  const [copied, setCopied] = React.useState(false);\n\n  const handleSongEvent = React.useCallback(\n    (songEvent) => {\n      setSongHistory((h) => [songEvent].concat(h));\n    },\n    [setSongHistory]\n  );\n\n  React.useEffect(() => {\n    if (authInfo) {\n      API.graphql(\n        graphqlOperation(queries.songEventsByUserId, {\n          userID: authInfo.username,\n          sortDirection: \"DESC\",\n          limit: 10,\n        })\n      ).then((response) => {\n        setSongHistory(response.data?.songEventsByUserID?.items ?? []);\n      });\n    }\n  }, [authInfo]);\n\n  React.useEffect(() => {\n    if (copied) {\n      const timeoutID = setTimeout(() => {\n        setCopied(false);\n      }, 2000);\n      return () => clearTimeout(timeoutID);\n    }\n  }, [copied]);\n\n  if (authInfo == null) {\n    return <div>Login to spotify to set the eardrum monster free</div>;\n  }\n\n  const trackList =\n    songHistory == null ? null : (\n      <div className=\"Broadcast-history\">\n        <TrackList songs={songHistory.slice(1)} />\n      </div>\n    );\n\n  const shareURI = `https://eardrum.monster/u/${authInfo.displayName}`;\n\n  const player =\n    (spotifyWebPlayer == null && webPlayerUnsupported === false) ||\n    songHistory == null ? (\n      <div>Initializing Spotify...</div>\n    ) : (\n      <>\n        <div className=\"Broadcast-title\">\n          <BroadcastHeading hostDisplayName={authInfo.displayName} />\n        </div>\n        <div className=\"Broadcast-text\">You are the DJ.</div>\n        <div className=\"Broadcast-text\">\n          <div>1. Control your spotify like normal to change the music</div>\n          <div>2. keep this page open to continue streaming</div>\n        </div>\n        <div className=\"Broadcast-text\">\n          Share this URL to add listeners:\n          <input value={shareURI} disabled size={shareURI.length} />\n          <button>\n            <CopyToClipboard\n              text={`https://eardrum.monster/u/${authInfo.displayName}`}\n              onCopy={() => {\n                setCopied(true);\n              }}\n            >\n              <span>{copied ? \"Copied!\" : \"Copy\"}</span>\n            </CopyToClipboard>\n          </button>\n        </div>\n        <WakeLockControl />\n        <PowerHourControl />\n        <EQBars className=\"Broadcast-streaming\" />\n        <p>Now playing:</p>\n        <div className=\"Broadcast-currentTrack\">\n          <BroadcastPublisher\n            currentSongEvent={songHistory[0]}\n            onSongEvent={handleSongEvent}\n          />\n          <Track track={songHistory[0]?.track} />\n        </div>\n      </>\n    );\n\n  return (\n    <div className=\"Broadcast\">\n      <div className=\"Broadcast-listeners\">\n        <Listeners\n          hostUserID={authInfo.username}\n          hostDisplayName={authInfo.displayName}\n          hostUserImg={authInfo.userImg}\n        />\n      </div>\n      <div className=\"Broadcast-player\">\n        {player}\n        {trackList}\n      </div>\n    </div>\n  );\n}\n\nexport default Broadcast;\n","import React from \"react\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport Listen from \"./Listen.js\";\r\nimport Broadcast from \"./Broadcast.js\";\r\nimport { AuthContext } from \"./Auth.js\";\r\nimport { API, graphqlOperation } from \"aws-amplify\";\r\nimport * as queries from \"./graphql/queries\";\r\n\r\nfunction fetchHostByDisplayName(hostDisplayName) {\r\n  return API.graphql(\r\n    graphqlOperation(queries.usersByDisplayName, {\r\n      displayName: hostDisplayName,\r\n      sortDirection: \"DESC\",\r\n      limit: 1,\r\n    })\r\n  ).then((data) => {\r\n    return data?.data?.usersByDisplayName?.items?.[0];\r\n  });\r\n}\r\n\r\nfunction Channel() {\r\n  const authInfo = React.useContext(AuthContext);\r\n  const { id } = useParams();\r\n  const [hostUserID, setHostUserID] = React.useState(null);\r\n  const [hostUserImg, setHostUserImg] = React.useState(null);\r\n  const [failedLookup, setFailedLookup] = React.useState(false);\r\n  const hostDisplayName = decodeURIComponent(id);\r\n\r\n  //Resolve host username\r\n  React.useEffect(() => {\r\n    if (authInfo != null && authInfo.displayName === hostDisplayName) {\r\n      setHostUserID(authInfo?.username);\r\n      return;\r\n    }\r\n\r\n    fetchHostByDisplayName(hostDisplayName)\r\n      .then((host) => {\r\n        if (host?.userID == null) {\r\n          throw new Error(\"Could not locate user\");\r\n        }\r\n        setHostUserID(host.userID);\r\n        setHostUserImg(host?.userImg);\r\n      })\r\n      .catch(() => {\r\n        setFailedLookup(true);\r\n      });\r\n  }, [authInfo, id, hostDisplayName]);\r\n\r\n  if (failedLookup) {\r\n    return <div className=\"Listen\">User not found</div>;\r\n  }\r\n\r\n  if (hostUserID == null) {\r\n    return null;\r\n  }\r\n\r\n  if (authInfo?.displayName === hostDisplayName) {\r\n    return <Broadcast />;\r\n  }\r\n\r\n  return (\r\n    <Listen\r\n      hostDisplayName={hostDisplayName}\r\n      hostUserID={hostUserID}\r\n      hostUserImg={hostUserImg}\r\n    />\r\n  );\r\n}\r\n\r\nexport default Channel;\r\n","import React from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { graphqlOperation } from \"aws-amplify\";\r\nimport { Connect } from \"aws-amplify-react\";\r\nimport \"./Home.css\";\r\n// import { AuthContext } from \"./Auth.js\";\r\nimport * as queries from \"./graphql/customQueries\";\r\n// import EQBars from \"./EQBars.js\";\r\n// import useAuth from \"./useAuth\";\r\nimport logo from \"./logo.png\";\r\nimport { isUserOnline, getListenerCount } from \"./Utils\";\r\n\r\nimport type { User } from \"./Types\";\r\n\r\nfunction Channel({\r\n  img,\r\n  cta,\r\n  title,\r\n  subtitle,\r\n}: {\r\n  img: string | null;\r\n  title: string;\r\n  subtitle: string;\r\n  cta: React.ReactNode;\r\n}) {\r\n  return (\r\n    <div className=\"Home-user\">\r\n      <div className=\"Home-userTitle\">{title}</div>\r\n      <div className=\"Home-userSubtitle\">{subtitle}</div>\r\n      <img className=\"Home-userImg\" src={img ?? logo} alt=\"Album art\" />\r\n      {cta}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function ChannelList() {\r\n  return (\r\n    <div className=\"ChannelList\">\r\n      <h2 className=\"Home-title\">\r\n        {/* eslint-disable-next-line jsx-a11y/accessible-emoji */}\r\n        😈 Users currently streaming 😈\r\n      </h2>\r\n      <Connect\r\n        query={graphqlOperation(queries.usersByLatestSongEventCustom, {\r\n          type: \"USER\",\r\n          sortDirection: \"DESC\",\r\n          limit: 50,\r\n        })}\r\n      >\r\n        {({ data, loading, error }: any) => {\r\n          if (error) return <h3>Error</h3>;\r\n          if (loading || !data) return <h3>Loading...</h3>;\r\n          const users =\r\n            (data.usersByLatestSongEvent &&\r\n              data.usersByLatestSongEvent.items) ??\r\n            [];\r\n          const onlineUsers = users\r\n            .filter((user: User) => isUserOnline(user))\r\n            .sort((a: User, b: User) =>\r\n              getListenerCount(a) > getListenerCount(b) ? -1 : 1\r\n            );\r\n          return (\r\n            <div className=\"Home-userList\">\r\n              {onlineUsers.map((user: User) => {\r\n                if (user == null) {\r\n                  return null;\r\n                }\r\n                const latestSong = user.songEvents?.items?.[0];\r\n                const img = latestSong?.track?.albumImg ?? null;\r\n                const numListeners = getListenerCount(user);\r\n                return (\r\n                  <Channel\r\n                    key={user.userID}\r\n                    img={img}\r\n                    title={user.displayName || user.userID}\r\n                    subtitle={`${numListeners} ${\r\n                      numListeners === 1 ? \"listener\" : \"listeners\"\r\n                    }`}\r\n                    cta={\r\n                      <Link\r\n                        className=\"Home-link\"\r\n                        to={`/u/${encodeURIComponent(\r\n                          user.displayName || user.userID\r\n                        )}`}\r\n                      >\r\n                        {/* eslint-disable-next-line jsx-a11y/accessible-emoji */}\r\n                        Join ▶️\r\n                      </Link>\r\n                    }\r\n                  />\r\n                );\r\n              })}\r\n              <Channel\r\n                img={null}\r\n                title=\"Start a channel\"\r\n                subtitle=\"\"\r\n                cta={\r\n                  <Link className=\"Home-link\" to={`/broadcast`}>\r\n                    My channel\r\n                  </Link>\r\n                }\r\n              />\r\n            </div>\r\n          );\r\n        }}\r\n      </Connect>\r\n    </div>\r\n  );\r\n}\r\n","export const usersByLatestSongEventCustom = /* GraphQL */ `\r\n  query UsersByLatestSongEventCustom(\r\n    $type: String\r\n    $latestSongEvent: ModelIntKeyConditionInput\r\n    $sortDirection: ModelSortDirection\r\n    $filter: ModelUserFilterInput\r\n    $limit: Int\r\n    $nextToken: String\r\n  ) {\r\n    usersByLatestSongEvent(\r\n      type: $type\r\n      latestSongEvent: $latestSongEvent\r\n      sortDirection: $sortDirection\r\n      filter: $filter\r\n      limit: $limit\r\n      nextToken: $nextToken\r\n    ) {\r\n      items {\r\n        userID\r\n        displayName\r\n        userImg\r\n        latestSongEvent\r\n        latestListenPing\r\n        listeningTo\r\n        songEvents(sortDirection: DESC) {\r\n          items {\r\n            id\r\n            spotifyURI\r\n            timestamp\r\n            position\r\n            userID\r\n            type\r\n            track {\r\n              durationMs\r\n              name\r\n              albumName\r\n              albumImg\r\n            }\r\n          }\r\n          nextToken\r\n        }\r\n        listeners(sortDirection: DESC) {\r\n          items {\r\n            userID\r\n            latestSongEvent\r\n            latestListenPing\r\n            listeningTo\r\n            type\r\n          }\r\n          nextToken\r\n        }\r\n        type\r\n      }\r\n      nextToken\r\n    }\r\n  }\r\n`;\r\n","import React from \"react\";\r\nimport \"./Home.css\";\r\nimport ChannelList from \"./ChannelList\";\r\n\r\nfunction Home() {\r\n  /* eslint-disable jsx-a11y/accessible-emoji */\r\n  return (\r\n    <div className=\"Home\">\r\n      <div>\r\n        <em>\r\n          eardrum.monster allows you to sync your spotify client with friends\r\n        </em>\r\n      </div>\r\n      <div className=\"Home-list\">\r\n        <ChannelList />\r\n      </div>\r\n      <div className=\"Home-content\">\r\n        <h1>How do I use it?</h1>\r\n        <div>1. Join a channel or create your own ☝️</div>\r\n        <div>2. Share the URL with your friends️</div>\r\n        <h1>Its great for:</h1>\r\n        <div>\r\n          ✅ Streamers who want to let their viewers sync up their music with\r\n          high quality spotify audio\r\n        </div>\r\n        <div>✅ Online gamers who want listen together while gaming</div>\r\n        <div>\r\n          ✅ People who are quarantined and want to have virtual power hours\r\n          together\r\n        </div>\r\n\r\n        <h1>Did you say power hour?</h1>\r\n        <div>\r\n          ✅ Yes! eardrum.monster now features <em>Power hour mode™️</em> that\r\n          will automatically change the song every 60s. Everybody must drink\r\n          when the song changes.\r\n        </div>\r\n\r\n        <h1>Can I play century club?</h1>\r\n        <div>\r\n          ✅ We've got you covered! <em>Power hour mode™️</em> will keep em'\r\n          coming well beyond the traditional 60 minutes so you can attempt to\r\n          join the century club as many times as you want!\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Home;\r\n","import React from \"react\";\r\nimport useAuth from \"./useAuth\";\r\nimport { Redirect, useLocation } from \"react-router-dom\";\r\nimport { getAuthorizeURI } from \"./Auth\";\r\n\r\nexport default function RedirectToLoginOrBroadcast() {\r\n  const location = useLocation();\r\n  const authInfo = useAuth();\r\n  if (authInfo && typeof authInfo.displayName === \"string\") {\r\n    return <Redirect to={`/u/${encodeURIComponent(authInfo.displayName)}`} />;\r\n  }\r\n  window.location.href = getAuthorizeURI(location.pathname);\r\n  return null;\r\n}\r\n","import React from \"react\";\r\nimport \"./App.css\";\r\nimport Header from \"./Header.js\";\r\nimport Channel from \"./Channel.js\";\r\nimport Home from \"./Home\";\r\nimport { BrowserRouter as Router, Switch, Route } from \"react-router-dom\";\r\nimport { AuthProvider, AuthRedirect } from \"./Auth.js\";\r\nimport { SpotifyProvider } from \"./SpotifyContext\";\r\nimport RedirectToLoginOrBroadcast from \"./RedirectToLoginOrBroadcast\";\r\n\r\nfunction App() {\r\n  return (\r\n    <div className=\"App\">\r\n      <Router>\r\n        <AuthProvider>\r\n          <Header />\r\n          <Switch>\r\n            <Route path=\"/auth/\">\r\n              <AuthRedirect />\r\n            </Route>\r\n            <SpotifyProvider>\r\n              <div className=\"App-content\">\r\n                <Route exact path=\"/\">\r\n                  <Home />\r\n                </Route>\r\n                <Route path=\"/u/:id\">\r\n                  <Channel />\r\n                </Route>\r\n                <Route path=\"/broadcast\">\r\n                  <RedirectToLoginOrBroadcast />\r\n                </Route>\r\n                <Route path=\"/premium_required\">\r\n                  {/* eslint-disable-next-line jsx-a11y/accessible-emoji */}\r\n                  <div className=\"App-msg\">\r\n                    Error: Spotify premium required for syncing with\r\n                    eardrum.monster 😞\r\n                  </div>\r\n                </Route>\r\n              </div>\r\n            </SpotifyProvider>\r\n          </Switch>\r\n        </AuthProvider>\r\n      </Router>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === \"localhost\" ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === \"[::1]\" ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener(\"load\", () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            \"This web app is being served cache-first by a service \" +\r\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === \"installed\") {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                \"New content is available and will be used when all \" +\r\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log(\"Content is cached for offline use.\");\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error(\"Error during service worker registration:\", error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { \"Service-Worker\": \"script\" },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get(\"content-type\");\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        \"No internet connection found. App is running in offline mode.\"\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if (\"serviceWorker\" in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister();\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","// WARNING: DO NOT EDIT. This file is automatically generated by AWS Amplify. It will be overwritten.\r\n\r\nconst awsmobile = {\r\n    aws_project_region: \"us-east-1\",\r\n    aws_appsync_graphqlEndpoint:\r\n      \"https://kponrlcw6jap7j62gb56h2abf4.appsync-api.us-east-1.amazonaws.com/graphql\",\r\n    aws_appsync_region: \"us-east-1\",\r\n    aws_appsync_authenticationType: \"API_KEY\",\r\n    aws_appsync_apiKey: \"da2-jxgfvq7zzvacfozrt7vucdiipq\",\r\n   };\r\n   \r\n   export default awsmobile;","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./index.css\";\r\nimport App from \"./App\";\r\nimport * as serviceWorker from \"./serviceWorker\";\r\nimport awsconfig from \"./aws-exports\";\r\nimport Amplify from \"aws-amplify\";\r\n\r\nAmplify.configure(awsconfig);\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById(\"root\")\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n","module.exports = __webpack_public_path__ + \"static/media/logo.86828523.png\";"],"sourceRoot":""}